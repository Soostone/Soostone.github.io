<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="manifest" href="/manifest.json" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/main.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/touch-icon/logo-76.png" /> <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/touch-icon/logo-120.png" /> <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/touch-icon/logo-152.png" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/touch-icon/logo-180.png" /> <meta name="msapplication-square70x70logo" content="/assets/images/touch-icon/logo-70.png" /> <meta name="msapplication-square150x150logo" content="/assets/images/touch-icon/logo-150.png" /> <meta name="msapplication-square310x310logo" content="/assets/images/touch-icon/logo-310.png" /> <!-- keywords not used by google but other search engines might still use --> <meta name="keywords" content="Napkin, BigQuery, Postgres, SQL, BigData, Data Scientist, Data Engineer, Analytics" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Fundamentals | docs</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Fundamentals" /> <meta name="author" content="Kayvan Kazeminejad" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Tutorial a new Napkin user with examples showing all features and usecases." /> <meta property="og:description" content="Tutorial a new Napkin user with examples showing all features and usecases." /> <link rel="canonical" href="https://soostone.github.io/fundamentals/" /> <meta property="og:url" content="https://soostone.github.io/fundamentals/" /> <meta property="og:site_name" content="docs" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Fundamentals" /> <script type="application/ld+json"> {"headline":"Fundamentals","url":"https://soostone.github.io/fundamentals/","@type":"WebPage","description":"Tutorial a new Napkin user with examples showing all features and usecases.","author":{"@type":"Person","name":"Kayvan Kazeminejad"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://soostone.github.io/assets/images/logo-and-name.svg"},"name":"Kayvan Kazeminejad"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="site-super-header"> <div class="ssh-container"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-nav"> <a class="link-button active" href="#">Documentation</a> <a class="link-button" href="#">Community</a> <a class="link-button" href="#">Features</a> <a class="link-button" href="#">Use Cases</a> <span class="gradient-border"> <a class="link-button " href="#">Install</a> </span> </div> </div> <div class="menu__button" style="-webkit-user-select: text;" aria-label="menu" role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu" aria-expanded="false"> <div class="menu__button-block"> <div class="menu__button-line top"></div> <div class="menu__button-line mid"></div> <div class="menu__button-line bot"></div> </div> </div> </div> </div> <div class="side-bar" style="display: none;"> <div class="site-header"> <a href="https://soostone.github.io/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </nav> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search docs" aria-label="Search docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div class="btn-sort-cats">Sort Categories <span><img src="/assets/images/down-arrow.svg" alt=""></span>
</div> <div class="side-bar"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </div> <div class="main-content-lspander"></div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <ol id="markdown-toc"> <li>
<a href="#napkin-fundamentals" id="markdown-toc-napkin-fundamentals">Napkin Fundamentals</a> <ol> <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li> <li>
<a href="#running-napkin" id="markdown-toc-running-napkin">Running Napkin</a> <ol> <li><a href="#the-napkin-model" id="markdown-toc-the-napkin-model">The Napkin Model</a></li> <li><a href="#setting-up-sqlite-chinook-database" id="markdown-toc-setting-up-sqlite-chinook-database">Setting up Sqlite Chinook database</a></li> <li>
<a href="#napkin-managed-tables" id="markdown-toc-napkin-managed-tables">Napkin Managed tables</a> <ol> <li>
<a href="#client_countries" id="markdown-toc-client_countries">Client_countries</a> <ol> <li><a href="#assertions" id="markdown-toc-assertions">Assertions</a></li> </ol> </li> <li><a href="#top-10-client_countries" id="markdown-toc-top-10-client_countries">Top 10 client_countries</a></li> </ol> </li> </ol> </li> </ol> </li> </ol> <h1 id="napkin-fundamentals"> <a href="#napkin-fundamentals" class="anchor-heading" aria-labelledby="napkin-fundamentals"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Napkin Fundamentals </h1> <p>This is the first of series of tutorials to get up and running with Napkin development. We do this through the example of building a simple Napkin data pipeline. The goal is that by the end of this tutorial, you’ll have a good idea of:</p> <ul> <li>How to start a Napkin project</li> <li>How to modify and verify and execute your Napkin project</li> <li>How Napkin helps you build a real-life application fast.</li> </ul> <p>With that, let’s get started!</p> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <p>Please make sure you have Napkin installed as per instruction from our <a href="/install">Installing Napkin</a> page.</p> <p>You will also need some common software tools to build and interact with the Napkin project.</p> <ul> <li>
<a href="https://www.sqlite.org/download.html" target="_blank" rel="noopener noreferrer">SQLite</a> as our backend database loaded with Chinook data</li> <li>A terminal application for command line interaction.</li> </ul> <h2 id="running-napkin"> <a href="#running-napkin" class="anchor-heading" aria-labelledby="running-napkin"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running Napkin </h2> <p>We’ll start by getting the Napkin up and running, and then explain the different Napkin commands which we will later extend. At any point, you can ask Napkin for help by using Napkin CLI help command:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin <span class="nt">--help</span>
</code></pre></div></div> <p>First, open a terminal, change to a folder in which to create your first project, and bootstrap your first Napkin project</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin init <span class="nt">--project-name</span> chinook-analytic
</code></pre></div></div> <p>This creates a new folder with contents from our <code class="language-plaintext highlighter-rouge">:basic</code> template.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chinook-analytic
  ├── hie.yaml
  ├── README.md
  ├── specs
  │   └── spec.yaml
  └── sql
      └── example.sql
</code></pre></div></div> <p>Use :</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin templates
</code></pre></div></div> <p>To see a list of all available templates</p> <p>For additional information in using more advanced templates use Napkin’s comprehensive help command/sub-commnad:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin init <span class="nt">--help</span>
</code></pre></div></div> <h3 id="the-napkin-model"> <a href="#the-napkin-model" class="anchor-heading" aria-labelledby="the-napkin-model"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Napkin Model </h3> <p>In your terminal, navigate to the root of the chinook-analytic project and run:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin validate <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <p>This should indicate our Napkin project, although empty, is syntactically valid.</p> <p>Napkin code defines the backend, and the workflow of our data-pipeline. Both concepts are described in the <code class="language-plaintext highlighter-rouge">specs/spec.yaml</code>:</p> <h4 id="specs-spec-yaml" class="top-code-caption"> <a href="#specs-spec-yaml" class="anchor-heading" aria-labelledby="specs-spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> specs/spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=http://soostone-napkin-public.s3-website.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to Sqlite database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:.chinook-sql.db</span>

<span class="na">tables</span><span class="pi">:</span>
<span class="nn">...</span>
</code></pre></div></div> <p>There are several important aspects here</p> <ul> <li>Spec, a high level <a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank" rel="noopener noreferrer">DSL</a> in <a href="https://en.wikipedia.org/wiki/YAML" target="_blank" rel="noopener noreferrer">YAML configuration language</a> is the interface to Napkin</li> <li>The backend database and the corresponding connection URL</li> <li>a list napkin managed tables</li> </ul> <h3 id="setting-up-sqlite-chinook-database"> <a href="#setting-up-sqlite-chinook-database" class="anchor-heading" aria-labelledby="setting-up-sqlite-chinook-database"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up Sqlite Chinook database </h3> <p>1- Download Chinook database 2- Create a local instance of SQLite Chinook database</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-L</span> https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite.sql | dos2unix <span class="o">&gt;</span> .chinook_sqlite.sql
<span class="nb">cat</span> <span class="nv">$SQLITE_DUMP</span> | sqlite3 .chinook-sql.db
</code></pre></div></div> <p>The script above installs a local copy of Chinook database:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 ./.chinook-sql.db
</code></pre></div></div> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">31</span><span class="p">.</span><span class="mi">1</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">54</span>
<span class="n">Enter</span> <span class="nv">".help"</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">tables</span>
<span class="n">Album</span>          <span class="n">Employee</span>       <span class="n">InvoiceLine</span>    <span class="n">PlaylistTrack</span>
<span class="n">Artist</span>         <span class="n">Genre</span>          <span class="n">MediaType</span>      <span class="n">Track</span>
<span class="n">Customer</span>       <span class="n">Invoice</span>        <span class="n">Playlist</span>
</code></pre></div></div> <h3 id="napkin-managed-tables"> <a href="#napkin-managed-tables" class="anchor-heading" aria-labelledby="napkin-managed-tables"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Napkin Managed tables </h3> <p>Lets create ranking of Chinook sales to countries. For instance we might want to know the top 10, or 20, countries with the most invoices.</p> <p>1- group invoices by country 2- get the top <code class="language-plaintext highlighter-rouge">n</code> performers</p> <h4 id="client_countries"> <a href="#client_countries" class="anchor-heading" aria-labelledby="client_countries"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Client_countries </h4> <p>To create our first Napkin managed table, we first create the <code class="language-plaintext highlighter-rouge">sql/client_countries.sql</code></p> <h4 id="sql-client-countries-sql" class="top-code-caption"> <a href="#sql-client-countries-sql" class="anchor-heading" aria-labelledby="sql-client-countries-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/client_countries.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- client countries and total invoices</span>
<span class="k">SELECT</span>
    <span class="n">BillingCountry</span> <span class="k">AS</span> <span class="n">billingCountry</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Invoices</span>
<span class="k">FROM</span>
    <span class="n">Invoice</span>
<span class="k">GROUP</span> <span class="k">BY</span>
    <span class="n">BillingCountry</span>
<span class="k">ORDER</span> <span class="k">BY</span>
    <span class="n">Invoices</span> <span class="k">DESC</span>
</code></pre></div></div> <p>We then modify the <code class="language-plaintext highlighter-rouge">specs/spec.yaml</code> to create the <code class="language-plaintext highlighter-rouge">client_countries</code> managed table</p> <h4 id="specs-spec-yaml" class="top-code-caption"> <a href="#specs-spec-yaml" class="anchor-heading" aria-labelledby="specs-spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> specs/spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=http://soostone-napkin-public.s3-website.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to Sqlite database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:.chinook-sql.db</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="c1">## countries have the most Invoices</span>
  <span class="na">client_countries</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">client_countries.sql</span>
</code></pre></div></div> <p>Next we validate that our Spec is still valid:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin validate <span class="nt">--spec-file</span> specs/spec.yaml
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
</code></pre></div></div> <p>and finally we run our spec:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Determining</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">update</span><span class="o">...</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Unmanaged</span> <span class="n">tables</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="n">as</span> <span class="n">an</span> <span class="n">input</span> <span class="n">in</span> <span class="k">this</span> <span class="nl">run:</span>
<span class="o">-</span> <span class="nc">Invoice</span>

<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Managed</span> <span class="n">tables</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="n">as</span> <span class="n">an</span> <span class="n">input</span> <span class="n">in</span> <span class="k">this</span> <span class="n">run</span><span class="o">,</span> <span class="n">but</span> <span class="n">will</span> <span class="n">not</span> <span class="n">be</span> <span class="nl">updated:</span>
<span class="o">[]</span>

<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Managed</span> <span class="n">tables</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">updated</span> <span class="n">in</span> <span class="k">this</span> <span class="nl">run:</span>
<span class="o">-</span> <span class="n">client_countries</span>

<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Estimated</span> <span class="nl">runtime:</span> <span class="mi">0</span><span class="n">s</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Running</span> <span class="n">table</span> <span class="nf">hooks</span> <span class="o">(</span><span class="nc">Pre</span><span class="o">)</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Running</span> <span class="n">table</span> <span class="nf">hooks</span> <span class="o">(</span><span class="nc">Post</span><span class="o">)</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span> <span class="n">processing</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"client_countries"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"client_countries"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">:</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span> <span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span><span class="mi">58</span><span class="o">][</span><span class="nc">Info</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span>
</code></pre></div></div> <p>To verify the result of our first Napkin run, we examine the state of our SQLite database:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 ./.chinook-sql.db
</code></pre></div></div> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">31</span><span class="p">.</span><span class="mi">1</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">54</span>
<span class="n">Enter</span> <span class="nv">".help"</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">tables</span>
<span class="n">Album</span>             <span class="n">Employee</span>          <span class="n">InvoiceLine</span>       <span class="n">PlaylistTrack</span>
<span class="n">Artist</span>            <span class="n">Genre</span>             <span class="n">MediaType</span>         <span class="n">Track</span>
<span class="n">Customer</span>          <span class="n">Invoice</span>           <span class="n">Playlist</span>          <span class="n">client_countries</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">client_countries</span><span class="p">;</span>
<span class="n">USA</span><span class="o">|</span><span class="mi">91</span>
<span class="n">Canada</span><span class="o">|</span><span class="mi">56</span>
<span class="n">Brazil</span><span class="o">|</span><span class="mi">35</span>
<span class="n">France</span><span class="o">|</span><span class="mi">35</span>
<span class="n">Germany</span><span class="o">|</span><span class="mi">28</span>
<span class="n">United</span> <span class="n">Kingdom</span><span class="o">|</span><span class="mi">21</span>
<span class="n">Czech</span> <span class="n">Republic</span><span class="o">|</span><span class="mi">14</span>
<span class="n">Portugal</span><span class="o">|</span><span class="mi">14</span>
<span class="n">India</span><span class="o">|</span><span class="mi">13</span>
<span class="n">Argentina</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Australia</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Austria</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Belgium</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Chile</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Denmark</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Finland</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Hungary</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Ireland</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Italy</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Netherlands</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Norway</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Poland</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Spain</span><span class="o">|</span><span class="mi">7</span>
<span class="n">Sweden</span><span class="o">|</span><span class="mi">6</span>
</code></pre></div></div> <h5 id="assertions"> <a href="#assertions" class="anchor-heading" aria-labelledby="assertions"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assertions </h5> <p>Next we use the <code class="language-plaintext highlighter-rouge">post-hook</code> capability of Napkin add some <a href="https://en.wikipedia.org/wiki/Test_assertion" target="_blank" rel="noopener noreferrer">test assertion</a></p> <h4 id="spec-spec-yaml" class="top-code-caption"> <a href="#spec-spec-yaml" class="anchor-heading" aria-labelledby="spec-spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec/spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=http://soostone-napkin-public.s3-website.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to Sqlite database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:.chinook-sql.db</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="c1">## countries have the most Invoices</span>
  <span class="na">client_countries</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">client_countries.sql</span>
    <span class="na">post_hooks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">assert_unique</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">client_countries</span>
          <span class="na">columns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">billingCountry</span>
</code></pre></div></div> <h4 id="top-10-client_countries"> <a href="#top-10-client_countries" class="anchor-heading" aria-labelledby="top-10-client_countries"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Top 10 client_countries </h4> <p>TBD</p> <h4 id="sql" class="top-code-caption"> <a href="#sql" class="anchor-heading" aria-labelledby="sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="o">*</span>
<span class="k">FROM</span>
    
<span class="k">ORDER</span> <span class="k">BY</span>
     <span class="k">FETCH</span> <span class="k">FIRST</span>  <span class="k">ROWS</span> <span class="k">ONLY</span>
</code></pre></div></div> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=http://soostone-napkin-public.s3-website.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to Sqlite database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:.chinook-sql.db</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="c1">## countries have the most Invoices</span>
  <span class="na">client_countries</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">client_countries.sql</span>
    <span class="na">post_hooks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">assert_unique</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">client_countries</span>
          <span class="na">columns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">billingCountry</span>

  <span class="c1">## top 10 countries have the most Invoices</span>
  <span class="na">top10_client_countries</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">top_performers.sql</span>
        <span class="na">vars</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">client_countries</span>
          <span class="na">max_limit</span><span class="pi">:</span> <span class="m">10</span>
          <span class="na">top_by</span><span class="pi">:</span> <span class="s">Invoices</span>

  <span class="c1">## breakdown countries by genres</span>
</code></pre></div></div> </div> </div> <div class="main-content-rspander"></div> <div class="search-overlay"></div> </div> <footer class="site-footer"> <div class="site-footer-rows"> <div class="site-footer-r1"> <div class="white-napkin"></div> <div class="sf-box"> <div class="sfb-nav"> <div class="link-table"> <a href="#" class="">Documentation</a> <a href="#" class="">Community</a> <a href="#" class="">Features</a> </div> <div class="link-table"> <a href="#" class="">Use Cases</a> <a href="#" class="">About Napkin</a> <a href="#" class="">Contact</a> </div> </div> <div class="gradient-border"> <a href="#" class="link-button">Get Napkin</a> </div> </div> </div> <div class="media-bar"> <span class="media-pad"> <a href="#" class="logo fb-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo twitter-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo linked-in-logo"></a> </span> </div> <div class="site-footer-copy-right"> <div class="copyright"> Copyright 2021 ©    |    <a href="#">Privacy Policy</a> </div> <div class="made-with"> Made with <span class="heart-inline"> </span> in NYC </div> </div> </div> </footer> <div class="sortcat-shadow"> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> <script type="text/javascript" src="/assets/js/highlight-active-link.js"></script> </body> </html>
