<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Getting Started - Napkin Wiki</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Getting Started | Napkin Wiki</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Getting Started" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin Wiki with howtos and tutorials." /> <meta property="og:description" content="Napkin Wiki with howtos and tutorials." /> <link rel="canonical" href="/getting-started/" /> <meta property="og:url" content="/getting-started/" /> <meta property="og:site_name" content="Napkin Wiki" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Getting Started" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/getting-started/","description":"Napkin Wiki with howtos and tutorials.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo-and-name.svg"}},"headline":"Getting Started","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item"> <a class="nav-list-link" href="https://napkinweb.webflow.io/"> Napkin product </a> </li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li><li class="nav-list-item active"><a href="/getting-started/" class="nav-list-link active">Getting Started</a></li><li class="nav-list-item"><a href="/haddock/" class="nav-list-link">Haddock</a></li><li class="nav-list-item"><a href="/tutorial/" class="nav-list-link">Tutorial</a></li><li class="nav-list-item"><a href="/user-manual/" class="nav-list-link">User Manual</a></li></ul> </nav> <footer class="site-footer"> <span>Copyright &copy; 2020-2021 <a href="http://soostone.com/" class="black"> <img style="height: 13px; vertical-align: bottom; padding-left: 5px;" src="/assets/images/logo-gem-100.png" /> Soostone </a> </span> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Napkin Wiki" aria-label="Search Napkin Wiki" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="getting-started"> <a href="#getting-started" class="anchor-heading" aria-labelledby="getting-started"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Started </h1> <h2 id="installation"> <a href="#installation" class="anchor-heading" aria-labelledby="installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h2> <p><strong>Napkin</strong> app is available in 2 forms: <a href="#live-installer">live installer</a> and <a href="#docker-version">dockerized version</a>.</p> <h3 id="live-installer"> <a href="#live-installer" class="anchor-heading" aria-labelledby="live-installer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Live installer </h3> <p>Live installer is a self extracting and self contained SHELL archive, which doesn’t require docker nor nix environment. As for now live installer <a href="https://soostone-napkin-public.s3.us-east-1.amazonaws.com/index.html" target="_blank" rel="noopener">repository</a> has versions for Mac OS Big Sur and Linux based distros.</p> <p>Find a page corresponding to your environment, copy installation snipped and executed it locally. Let’s say you run Mac, the latest build for MacOS Big Sur:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://soostone-napkin-public.s3.us-east-1.amazonaws.com/x86_64-MacOS-20.5.0/last-build/napkin-live-installer.sh <span class="se">\</span>
 | bash <span class="nt">-s</span> <span class="nt">--</span>
</code></pre></div></div> <p>The bundle is very fat and it contains all dependencies. If you need access to <code class="language-plaintext highlighter-rouge">ghci</code> - supply file pattern for derivations with apps you are interested in:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://soostone-napkin-public.s3.us-east-1.amazonaws.com/x86_64-MacOS-20.5.0/last-build/napkin-live-installer.sh <span class="se">\</span>
 | bash <span class="nt">-s</span> <span class="nt">--</span> <span class="nt">-e</span> <span class="s1">'*-ghc-*'</span>
</code></pre></div></div> <p>ghc derivation contains <strong>ghci-8.10.4</strong>. Pathes to napkin and all ghc apps are goin to be imported through <code class="language-plaintext highlighter-rouge">$PATH</code> variable. Don’t forget to start new shell session to update <code class="language-plaintext highlighter-rouge">$PATH</code> variable or you can benefit from <code class="language-plaintext highlighter-rouge">exec $SHELL</code> trick.</p> <h4 id="uninstallation"> <a href="#uninstallation" class="anchor-heading" aria-labelledby="uninstallation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Uninstallation </h4> <p>Napkin Live installer provides an uninstaller too.</p> <p>Type <code class="language-plaintext highlighter-rouge">uninstall-</code> and use tab to auto-complete script doing napkin uninstallation.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>uninstall-
<span class="nv">$ </span>uninstall-b82gj7f0igpw23sapafxifsrr0f52771-napkin-0.3.8.sh
</code></pre></div></div> <h3 id="docker-version"> <a href="#docker-version" class="anchor-heading" aria-labelledby="docker-version"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Docker version </h3> <p>Live installer is great, because it is very lightweight, but it is not available on <a href="https://en.wikipedia.org/wiki/Microsoft_Windows">Windows</a> yet. There are tutorials on the Internet for setting up <a href="https://nixos.wiki/wiki/Nix">Nix</a> with <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux">WSL</a> on Windows.</p> <h2 id="hello-world"> <a href="#hello-world" class="anchor-heading" aria-labelledby="hello-world"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hello world </h2> <p>Napkin has lots of interesting features and the toolset is constantlly growing. We have a bold roadmap for years!</p> <p>Let’s consider a killer feature, which is isolated and has a pretty simple user interface.</p> <p>Detection unused <a href="https://en.wikipedia.org/wiki/Hierarchical_and_recursive_queries_in_SQL#Common_table_expression">CTE</a> columns. Some table columns are introduced for debugging and development purpose, but as time goes an engineer can stop using them and completely forget, meanwhile such columns contribute into cost of running queries.</p> <p>napkin tools has command line interface. List available commands with <code class="language-plaintext highlighter-rouge">--help</code>.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>napkin <span class="nt">--help</span>
Usage: napkin <span class="o">[</span><span class="nt">-v</span>|--verbose] COMMAND
  Cli tool to work with Napkin
...

  find-unused-cte-columns  Parse SQL file and find unused CTE columns
...
</code></pre></div></div> <p>Detailed help for <code class="language-plaintext highlighter-rouge">find-unused-cte-columns</code> command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin find-unused-cte-columns <span class="nt">--help</span>
Usage: napkin find-unused-cte-columns <span class="o">(</span><span class="nt">-b</span>|--backend ARG<span class="o">)</span> <span class="o">(</span><span class="nt">-f</span>|--sql-file ARG<span class="o">)</span>
  Parse SQL file and find unused CTE columns

Available options:
  <span class="nt">-b</span>,--backend ARG         choose kind of SQL - BigQueryBackend or
                           PostgresqlBackend
  <span class="nt">-f</span>,--sql-file ARG        path to sql file
</code></pre></div></div> <p>Help syntax is same for the rest of commands.</p> <p>Let’s check following query for unused columns in an intermediate CTE table:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">CTE</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="n">f</span><span class="p">,</span> <span class="k">g</span> <span class="k">from</span> <span class="n">DbTable</span><span class="p">)</span> <span class="k">select</span> <span class="n">f</span> <span class="k">from</span> <span class="n">CTE</span>
</code></pre></div></div> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>napkin find-unused-cte-columns <span class="nt">-b</span> PostgresqlBackend <span class="nt">-f</span> query.sql
<span class="o">{</span><span class="s2">"CTE"</span>:[<span class="s2">"g"</span><span class="o">]}</span>
</code></pre></div></div> <p>To deal with a set of SQL files - generate a spec file, sort of a project file:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp </span>query.sql query2.sql
<span class="nv">$ </span><span class="nb">mkdir </span>sql
<span class="nv">$ </span><span class="nb">mv </span>query.sql query2.sql sql
<span class="nv">$ </span>napkin generate-spec <span class="nt">-d</span> sql
  Generated spec file at: specs/spec.yaml
<span class="nv">$ </span><span class="nb">cat </span>specs/spec.yaml  | <span class="nb">grep source
    source</span>: query.sql
    <span class="nb">source</span>: query2.sql

<span class="nv">$ </span><span class="nb">mv </span>sql specs <span class="c"># Tiny workaround - might not be needed in the future</span>

<span class="nv">$ </span>napkin optimize
Table: <span class="o">[</span>query]
query, CTE <span class="s2">"CTE"</span> has unused columns <span class="o">[</span><span class="s2">"g"</span><span class="o">]</span>
Table: <span class="o">[</span>query2]
query2, CTE <span class="s2">"CTE"</span> has unused columns <span class="o">[</span><span class="s2">"g"</span><span class="o">]</span>
</code></pre></div></div> <h2 id="comprehensive-list-of-use-cases"> <a href="#comprehensive-list-of-use-cases" class="anchor-heading" aria-labelledby="comprehensive-list-of-use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="/user-manual">Comprehensive list of use cases</a> </h2> </div> </div> <div class="search-overlay"></div> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> </body> </html>
