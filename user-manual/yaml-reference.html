<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="manifest" href="/manifest.json" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/main.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/touch-icon/logo-76.png" /> <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/touch-icon/logo-120.png" /> <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/touch-icon/logo-152.png" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/touch-icon/logo-180.png" /> <meta name="msapplication-square70x70logo" content="/assets/images/touch-icon/logo-70.png" /> <meta name="msapplication-square150x150logo" content="/assets/images/touch-icon/logo-150.png" /> <meta name="msapplication-square310x310logo" content="/assets/images/touch-icon/logo-310.png" /> <!-- keywords not used by google but other search engines might still use --> <meta name="keywords" content="Napkin, BigQuery, Postgres, SQL, BigData, Data Scientist, Data Engineer, Analytics" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Spec YAML reference | docs</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Spec YAML reference" /> <meta name="author" content="Kamil Figiela" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <meta property="og:description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <link rel="canonical" href="https://soostone.github.io/user-manual/yaml-reference" /> <meta property="og:url" content="https://soostone.github.io/user-manual/yaml-reference" /> <meta property="og:site_name" content="docs" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Spec YAML reference" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Kamil Figiela"},"url":"https://soostone.github.io/user-manual/yaml-reference","@type":"WebPage","description":"Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://soostone.github.io/assets/images/logo-and-name.svg"},"name":"Kamil Figiela"},"headline":"Spec YAML reference","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="site-super-header"> <div class="ssh-container"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-nav"> <a class="link-button active" href="/">Documentation</a> <a class="link-button" href="#">Community</a> <a class="link-button" href="#">Features</a> <a class="link-button" href="#">Use Cases</a> <span class="gradient-border"> <a class="link-button " href="/install">Install</a> </span> </div> </div> <div class="menu__button" style="-webkit-user-select: text;" aria-label="menu" role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu" aria-expanded="false"> <div class="menu__button-block"> <div class="menu__button-line top"></div> <div class="menu__button-line mid"></div> <div class="menu__button-line bot"></div> </div> </div> </div> </div> <div class="side-bar" style="display: none;"> <div class="site-header"> <a href="https://soostone.github.io/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/getting-started/" class="nav-list-link"> Getting started </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#homebrew" class="nav-list-link"> Homebrew </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul>
<li> <a href="/fundamentals/#getting-started" class="nav-list-link"> Getting Started </a> </li>
<li> <a href="/fundamentals/#bootstrapping-a-napkin-project" class="nav-list-link"> Bootstrapping napkin </a> </li>
<li> <a href="/fundamentals/#adding-computational-steps-to-the-pipeline" class="nav-list-link"> Adding Computations </a> </li>
<li> <a href="/fundamentals/#specsspecyaml" class="nav-list-link"> specs/spec.yaml </a> </li>
<li> <a href="/fundamentals/#napkin-cli" class="nav-list-link"> Napkin CLI </a> </li>
<li> <a href="/fundamentals/#napkin-remembers" class="nav-list-link"> Napkin remembers </a> </li>
<li> <a href="/fundamentals/#aggregations" class="nav-list-link"> Aggregations </a> </li>
<li> <a href="/fundamentals/#summary" class="nav-list-link"> Summary </a> </li>
<li> <a href="/fundamentals/#appendices" class="nav-list-link"> Appendices </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/yaml-reference" class="nav-list-link active">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/preprocessors" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running as a scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </nav> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search docs" aria-label="Search docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div class="btn-sort-cats">Sort Categories <span><img src="/assets/images/down-arrow.svg" alt=""></span>
</div> <div class="side-bar"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/getting-started/" class="nav-list-link"> Getting started </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#homebrew" class="nav-list-link"> Homebrew </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul>
<li> <a href="/fundamentals/#getting-started" class="nav-list-link"> Getting Started </a> </li>
<li> <a href="/fundamentals/#bootstrapping-a-napkin-project" class="nav-list-link"> Bootstrapping napkin </a> </li>
<li> <a href="/fundamentals/#adding-computational-steps-to-the-pipeline" class="nav-list-link"> Adding Computations </a> </li>
<li> <a href="/fundamentals/#specsspecyaml" class="nav-list-link"> specs/spec.yaml </a> </li>
<li> <a href="/fundamentals/#napkin-cli" class="nav-list-link"> Napkin CLI </a> </li>
<li> <a href="/fundamentals/#napkin-remembers" class="nav-list-link"> Napkin remembers </a> </li>
<li> <a href="/fundamentals/#aggregations" class="nav-list-link"> Aggregations </a> </li>
<li> <a href="/fundamentals/#summary" class="nav-list-link"> Summary </a> </li>
<li> <a href="/fundamentals/#appendices" class="nav-list-link"> Appendices </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/yaml-reference" class="nav-list-link active">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/preprocessors" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running as a scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </div> <div class="main-content-lspander"></div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://soostone.github.io/user-manual/">User Manual</a></li> <li class="breadcrumb-nav-list-item"><span>Spec YAML reference</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="spec-yaml-reference"> <a href="#spec-yaml-reference" class="anchor-heading" aria-labelledby="spec-yaml-reference"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spec YAML reference </h1> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable YAML schema in IDE</span>
<span class="c1"># yaml-language-server: $schema=http://soostone-napkin-public.s3-website.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># We don't allow extra fields except for top-level fields that start with _.</span>
<span class="c1"># They may be useful when YAML anchors are used for code reuse.</span>
<span class="na">_commonOptions</span><span class="pi">:</span> <span class="nl">&amp;common</span>
  <span class="na">some_common</span><span class="pi">:</span> <span class="s">options</span>

<span class="c1">## Application name</span>
<span class="na">app_name</span><span class="pi">:</span> <span class="s">foo bar</span>

<span class="c1">## Metadata configuration</span>
<span class="c1"># Napkin maintains a database with the history of runs. It's used to estimate pipeline runtime as well as to enforce update strategies.</span>
<span class="na">metadata_url</span><span class="pi">:</span> <span class="s">sqlite:metadata.db</span> <span class="c1"># optional, by default metadata will be stored in the Sqlite file in $PWD/data directory.</span>
<span class="c1"># metadata_url: postgresql://db@host/nakpin_metadata # metadata can be also stored in Postgres</span>

<span class="c1">#### Database connection configuration</span>

<span class="c1">## BigQuery</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">BigQuery</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">bigquery://bigquery.googleapis.com/project-acme?dataset=acme-analytics</span>
<span class="na">backend_options</span><span class="pi">:</span> <span class="c1"># backend specific options</span>
  <span class="na">labels</span><span class="pi">:</span> <span class="c1"># can be used to segregate costs in Google Cloud billing dashboard</span>
    <span class="na">client</span><span class="pi">:</span> <span class="s">acme</span>
    <span class="na">repo</span><span class="pi">:</span> <span class="s">client-acme</span>
  <span class="na">concurrent_queries</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="m">300</span>

<span class="c1">## Postgres</span>
<span class="c1"># backend: Postgres</span>
<span class="c1"># db_url: postgresql://user@db/napkin_db</span>
<span class="c1"># backend_options: # backend specific options</span>
<span class="c1">#   connection_pool: 100</span>

<span class="c1">## Sqlite</span>
<span class="c1"># backend: Sqlite</span>
<span class="c1"># db_url: sqlite:acme.db</span>
<span class="c1"># backend_options: {} # no backend options for Sqlite</span>

<span class="c1">## Location of SQL files when referenced in Spec.</span>
<span class="na">sql_folder</span><span class="pi">:</span> <span class="s">../sql</span> <span class="c1"># optional, this is a default value</span>

<span class="c1">## Location of Haskell files when referenced in Spec.</span>
<span class="na">haskell_folder</span><span class="pi">:</span> <span class="s">../haskell</span> <span class="c1"># optional, this is a default value</span>

<span class="c1">## Meta-programming &amp; scripting configuration</span>

<span class="c1">## List of Haskell modules that should be imported (in a qualified way) into the Mustache templating environment.</span>
<span class="c1"># You don't need to list modules used for table specs, hooks, preprocessors, etc. here.</span>
<span class="na">haskell_modules</span><span class="pi">:</span> <span class="c1"># optional, defaults to empty</span>
  <span class="pi">-</span> <span class="s">ACME.Mustache</span> <span class="c1"># Haskell module</span>

<span class="c1">## Haskell function that provides function macros that can extend SQL.</span>
<span class="na">function_macros</span><span class="pi">:</span> <span class="s">ACME.macros</span> <span class="c1"># optional, Haskell symbol, defaults to none</span>

<span class="c1">## Custom validator</span>
<span class="na">validator</span><span class="pi">:</span> <span class="s">ACME.validator</span> <span class="c1"># optional, Haskell symbol, defaults to none</span>

<span class="c1">## Haskell spec</span>
<span class="c1"># In addition to specifying tables in YAML, tables can be also specified in the Haskell program with Napkin DSL.</span>
<span class="na">haskell_spec</span><span class="pi">:</span> <span class="s">ACME.spec</span> <span class="c1"># optional, Haskell symbol, defaults to none</span>

<span class="c1">## Default extensions for Haskell interpreter</span>
<span class="na">haskell_default_language_extensions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">OverlappingInstances</span>
  <span class="pi">-</span> <span class="s">NoOverloadedStrings</span> <span class="c1"># extensions enabled by default can be disabled as well</span>

<span class="c1">## List of extra packages to be made available in the Haskell scripting</span>
<span class="c1"># Note: these extensions need to be present in a package DB. Please consult the user manual for directions on how to add extra packages.</span>
<span class="na">haskell_packages</span><span class="pi">:</span> <span class="c1"># optional, defaults to empty</span>
  <span class="pi">-</span> <span class="s">fmt</span>
  <span class="pi">-</span> <span class="s">yaml</span>

<span class="c1">## Spec preprocessors</span>
<span class="na">preprocessors</span><span class="pi">:</span> <span class="c1"># defaults to empty</span>

  <span class="c1"># Prefix all tables (according to configuration) without hardcoding the prefix directly in the Spec and queries</span>
  <span class="pi">-</span> <span class="na">table_prefix</span><span class="pi">:</span>
      <span class="c1"># one or both of value and override_with_arg need to be specified</span>
      <span class="na">value</span><span class="pi">:</span> <span class="s">development</span> <span class="c1"># prefix</span>
      <span class="na">override_with_arg</span><span class="pi">:</span> <span class="s">environment</span> <span class="c1"># allow to override with CLI, e.g. --arg environment=production</span>
      <span class="na">separator</span><span class="pi">:</span> <span class="s">_</span> <span class="c1"># defaults to empty,</span>
      <span class="c1"># scope: unmanaged</span>
      <span class="c1"># scope: all</span>
      <span class="c1"># only: [foo, bar, baz] # apply renamer only to selected tables</span>
      <span class="c1"># except: [foo, bar, baz] # apply renamer to all tables except selected tables</span>

  <span class="c1"># Move all tables (according to configuration) to dataset/schema without specifying it directly in the Spec and queries</span>
  <span class="pi">-</span> <span class="na">table_namespace</span><span class="pi">:</span>
      <span class="c1"># one or both of value and override_with_arg need to be specified</span>
      <span class="na">value</span><span class="pi">:</span> <span class="s">development</span> <span class="c1"># namespace</span>
      <span class="na">override_with_arg</span><span class="pi">:</span> <span class="s">environment</span> <span class="c1"># allow to override with CLI, e.g. --arg environment=production</span>
      <span class="na">scope</span><span class="pi">:</span> <span class="s">managed</span>
      <span class="c1"># scope: unmanaged</span>
      <span class="c1"># scope: all</span>
      <span class="na">only</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">foo</span><span class="pi">,</span> <span class="nv">bar</span><span class="pi">,</span> <span class="nv">baz</span><span class="pi">]</span> <span class="c1"># apply renamer only to selected tables</span>
      <span class="na">except</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">foo</span><span class="pi">,</span> <span class="nv">bar</span><span class="pi">,</span> <span class="nv">baz</span><span class="pi">]</span> <span class="c1"># apply renamer to all tables except selected tables</span>
      <span class="na">on_existing</span><span class="pi">:</span> <span class="s">overwrite</span> <span class="c1"># default, replace namespace even if it was specified explicitly</span>
      <span class="c1"># on_existing: keep_original # keep original namespace if it has been specified explicitly in the Spec</span>

  <span class="c1"># Custom preprocessor with some arguments (Haskell symbol)</span>
  <span class="pi">-</span> <span class="na">ACME.Preprocessors.example</span><span class="pi">:</span>
      <span class="na">some</span><span class="pi">:</span> <span class="s">arguments</span>

  <span class="c1"># Custom preprocessor without arguments (Haskell symbol)</span>
  <span class="pi">-</span> <span class="s">ACME.Preprocessors.example</span>

<span class="c1">## Tables that are managed by Napkin</span>
<span class="na">tables</span><span class="pi">:</span>
  <span class="na">some_table</span><span class="pi">:</span> <span class="c1"># Table name</span>
    <span class="c1"># Defines a method the table will be created with</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="c1"># This table should be created with a SQL query stored in a file</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">some_query.sql</span> <span class="c1"># SQL file location relative to sql_dir</span>
        <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span> <span class="c1"># default</span>
        <span class="c1"># target_type: view # create view instead of table</span>
        <span class="na">vars</span><span class="pi">:</span> <span class="c1"># Variables for Mustache templating, defaults to none</span>
          <span class="na">foo</span><span class="pi">:</span> <span class="s">bar</span>
          <span class="na">baz</span><span class="pi">:</span> <span class="s">boo</span>

    <span class="c1"># What should trigger table being updated or recreated, optional, defaults to: always</span>
    <span class="na">update_strategy</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">always</span> <span class="c1"># Update table always</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">periodically</span> <span class="c1"># Update table periodically (every hour = 3600 seconds). Requires metadata to be persisted between Napkin runs</span>
        <span class="na">period</span><span class="pi">:</span> <span class="m">3600</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">with_dependency</span> <span class="c1"># Update table when it's older than its dependency or the dependency will update as well during this run</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">if_missing</span> <span class="c1"># Update table when it does not exist</span>

    <span class="c1"># List of tables that are not referenced in the query, but should be considered as a dependency when scheduling, optional, defaults to empty</span>
    <span class="c1"># Typically, Napkin will discover all dependencies automatically, so it does not have to be used. You can double-check dependencies discovered with dump command</span>
    <span class="na">deps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">some_dependency</span>

    <span class="c1"># List of tables that are referenced in the query and should not be considered as a dependency when scheduling, optional, defaults to empty</span>
    <span class="c1"># Typically, Napkin will discover all dependencies automatically, so it does not have to be used. You can double-check dependencies discovered with dump command</span>
    <span class="na">hidden_deps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ignored_dependency</span>

    <span class="c1"># Backend specific table options, optional</span>
    <span class="na">table_options</span><span class="pi">:</span> <span class="c1"># Big Query options</span>
      <span class="na">partitioning</span><span class="pi">:</span>
        <span class="na">column</span><span class="pi">:</span> <span class="s">partitioning_column</span>
        <span class="na">range</span><span class="pi">:</span>
          <span class="na">start</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">end</span><span class="pi">:</span> <span class="m">100</span>
          <span class="na">step</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">write_disposition</span><span class="pi">:</span> <span class="s">append</span>
      <span class="na">clustering</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">clustering_column</span><span class="pi">]</span>

    <span class="c1"># Table tags, can be used to selectively enable or disable table execution with CLI flags during development</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">foo</span><span class="pi">,</span> <span class="nv">bar</span><span class="pi">,</span> <span class="nv">baz</span><span class="pi">]</span>

    <span class="c1">## Pre-hooks can be used to validate input data</span>
    <span class="c1"># See examples below what assertions are built-in</span>
    <span class="na">pre_hooks</span><span class="pi">:</span> <span class="c1"># optional, defaults to empty</span>
      <span class="pi">-</span> <span class="na">assert_unique</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">source_table</span>
          <span class="na">columns</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">some_column</span><span class="pi">]</span>

    <span class="c1">## Post-hooks can be used to validate query results</span>
    <span class="c1"># The same set of assertions can be used both in pre and post hooks</span>
    <span class="c1"># See examples below what assertions are built-in</span>
    <span class="na">post_hooks</span><span class="pi">:</span> <span class="c1"># optional, defaults to empty</span>
      <span class="pi">-</span> <span class="na">assert_unique</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">some_table</span>
          <span class="na">columns</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">result_column</span><span class="pi">]</span>
          <span class="c1"># on_failure controls how the hook failures are handled, this attribute applies to all hooks</span>
          <span class="na">on_failure</span><span class="pi">:</span> <span class="s">fail_now</span> <span class="c1"># default, fail the whole spec as soon hook fails</span>
          <span class="c1"># on_failure: fail_later # fail the whole spec, but allows remaining hooks for this table to be executed</span>
          <span class="c1"># on_failure: warn_only # don't fail the whole spec, failure will be logged in a report</span>

  <span class="na">inline_table</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="c1"># This table should be created with a SQL query inlined in the YAML file</span>
      <span class="na">sql_query</span><span class="pi">:</span>
        <span class="na">query</span><span class="pi">:</span> <span class="s">SELECT * FROM some_table</span>
        <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span> <span class="c1"># default</span>
        <span class="c1"># target_type: view # create view instead of table</span>

  <span class="na">incremental_by_time_table</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="c1"># This table should be updated with incremental by time strategy. Please refer to the user manual for details</span>
      <span class="na">incremental_by_time</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">incremental_query.sql</span> <span class="c1"># SQL file location relative to sql_dir</span>
        <span class="na">timestamp_column</span><span class="pi">:</span> <span class="s">column_foo</span> <span class="c1"># Column that contains timestamp</span>
        <span class="na">start_day</span><span class="pi">:</span> <span class="s">2021-01-01</span> <span class="c1"># Starting date, used when table is created from scratch</span>
        <span class="na">lookback_days</span><span class="pi">:</span> <span class="m">14</span> <span class="c1"># Last N days slice to be updated during subsequent runts</span>
        <span class="na">vars</span><span class="pi">:</span> <span class="c1"># Variables for Mustache templating, this program will implicitly provide "cutoff" variable</span>
          <span class="na">foo</span><span class="pi">:</span> <span class="s">bar</span>
          <span class="na">baz</span><span class="pi">:</span> <span class="s">boo</span>

  <span class="na">incremental_pk_table</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
    <span class="c1"># This table should be updated with incremental by time strategy. Please refer to the user manual for details</span>
      <span class="na">incremental_by_pk</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">incremental_pk.sql</span> <span class="c1"># SQL file location relative to sql_dir</span>
        <span class="na">pk</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">column_foo</span><span class="pi">]</span>
        <span class="na">start_day</span><span class="pi">:</span> <span class="s">2021-01-01</span>
        <span class="na">lookback_days</span><span class="pi">:</span> <span class="m">14</span>

  <span class="na">custom_prog</span><span class="pi">:</span>
    <span class="c1"># This table should be created by a custom program</span>
    <span class="c1"># since we don't provide any arguments to the program, we can use simplified syntax</span>
    <span class="na">create_action</span><span class="pi">:</span> <span class="s">ACME.custom_prog</span>

  <span class="na">custom_prog_with_args</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="c1"># This table should be created by a custom program</span>
      <span class="c1"># In this case we pass some arguments to the program</span>
      <span class="na">ACME.custom_prog</span><span class="pi">:</span>
        <span class="na">some_args</span><span class="pi">:</span> <span class="no">true</span>

  <span class="na">all_hooks</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">sql_file</span><span class="pi">:</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">some.sql</span>

    <span class="c1"># Example of all hooks available, can be used as pre_hooks as well</span>
    <span class="na">post_hooks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">assert_all_values_within</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">Invoice</span>
          <span class="na">column</span><span class="pi">:</span> <span class="s">InvoiceDate</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">date</span>
          <span class="na">from</span><span class="pi">:</span> <span class="s">2009-01-01</span>
          <span class="na">to</span><span class="pi">:</span> <span class="s">2013-12-31</span>

          <span class="c1"># on_failure controls how the hook failures are handled, this attribute applies to all hooks</span>
          <span class="na">on_failure</span><span class="pi">:</span> <span class="s">fail_now</span> <span class="c1"># default, fail the whole spec as soon hook fails</span>
          <span class="c1"># on_failure: fail_later # fail the whole spec, but allows remaining hooks for this table to be executed</span>
          <span class="c1"># on_failure: warn_only # don't fail the whole spec, failure will be logged in a report</span>

      <span class="pi">-</span> <span class="na">assert_any_values_within</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">Artist</span>
          <span class="na">column</span><span class="pi">:</span> <span class="s">Count</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">int</span>
          <span class="na">from</span><span class="pi">:</span> <span class="m">1</span>
          <span class="na">to</span><span class="pi">:</span> <span class="m">25</span>

      <span class="pi">-</span> <span class="na">assert_no_values_within</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">column</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">values</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Sweet Home Alabama</span>
            <span class="pi">-</span> <span class="s">Brain Damage</span>

      <span class="pi">-</span> <span class="na">assert_all_values_within</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">column</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">values</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Time</span>
            <span class="pi">-</span> <span class="s">The Great Gig In The Sky</span>
            <span class="pi">-</span> <span class="s">Any Colour You Like</span>
            <span class="pi">-</span> <span class="s">Brain Damage</span>
            <span class="pi">-</span> <span class="s">Sweet Home Alabama</span>

      <span class="pi">-</span> <span class="na">assert_unique</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">columns</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">Name</span><span class="pi">]</span>

      <span class="pi">-</span> <span class="na">assert_count</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">equal</span><span class="pi">:</span> <span class="m">123</span>

      <span class="pi">-</span> <span class="na">assert_count</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">greater_than_or_equal</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>

      <span class="pi">-</span> <span class="na">assert_count</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">approximately_equal</span><span class="pi">:</span> <span class="m">123</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">absolute</span>
          <span class="c1"># type: relative</span>
          <span class="na">tolerance</span><span class="pi">:</span> <span class="m">10</span> <span class="c1"># we can be off by 10 and it's still ok</span>

      <span class="pi">-</span> <span class="na">assert_cardinalities</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">column</span><span class="pi">:</span> <span class="s">name</span>
          <span class="na">equal</span><span class="pi">:</span>
            <span class="na">table</span><span class="pi">:</span> <span class="s">Artist</span>
            <span class="na">column</span><span class="pi">:</span> <span class="s">name</span>

      <span class="pi">-</span> <span class="na">assert_expression</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">expression</span><span class="pi">:</span> <span class="s">name</span>

      <span class="pi">-</span> <span class="na">assert_not_null</span><span class="pi">:</span>
          <span class="na">table</span><span class="pi">:</span> <span class="s">popular_tracks_for_pink_floyd</span>
          <span class="na">columns</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">some_column</span>
            <span class="pi">-</span> <span class="na">expression</span><span class="pi">:</span> <span class="s">NULLIF (some_column, '')</span>

      <span class="c1"># custom hook without arguments</span>
      <span class="pi">-</span> <span class="s">ACME.custom_hook</span>

      <span class="c1"># custom hook with arguments</span>
      <span class="pi">-</span> <span class="na">ACME.custom_hook</span><span class="pi">:</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">artists_hashes</span>
</code></pre></div></div> </div> </div> <div class="main-content-rspander"></div> <div class="search-overlay"></div> </div> <footer class="site-footer"> <div class="site-footer-rows"> <div class="site-footer-r1"> <div class="white-napkin"></div> <div class="sf-box"> <div class="sfb-nav"> <div class="link-table"> <a href="#" class="">Documentation</a> <a href="#" class="">Community</a> <a href="#" class="">Features</a> </div> <div class="link-table"> <a href="#" class="">Use Cases</a> <a href="#" class="">About Napkin</a> <a href="#" class="">Contact</a> </div> </div> <div class="gradient-border"> <a href="#" class="link-button">Get Napkin</a> </div> </div> </div> <div class="media-bar"> <span class="media-pad"> <a href="#" class="logo fb-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo twitter-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo linked-in-logo"></a> </span> </div> <div class="site-footer-copy-right"> <div class="copyright"> Copyright 2021 ©    |    <a href="#">Privacy Policy</a> </div> <div class="made-with"> Made with <span class="heart-inline"> </span> in NYC </div> </div> </div> </footer> <div class="sortcat-shadow"> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> <script type="text/javascript" src="/assets/js/highlight-active-link.js"></script> </body> </html>
