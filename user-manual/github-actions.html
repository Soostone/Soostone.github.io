<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="manifest" href="/manifest.json" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/main.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/touch-icon/logo-76.png" /> <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/touch-icon/logo-120.png" /> <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/touch-icon/logo-152.png" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/touch-icon/logo-180.png" /> <meta name="msapplication-square70x70logo" content="/assets/images/touch-icon/logo-70.png" /> <meta name="msapplication-square150x150logo" content="/assets/images/touch-icon/logo-150.png" /> <meta name="msapplication-square310x310logo" content="/assets/images/touch-icon/logo-310.png" /> <!-- keywords not used by google but other search engines might still use --> <meta name="keywords" content="Napkin, BigQuery, Postgres, SQL, BigData, Data Scientist, Data Engineer, Analytics" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Running scheduled job on GitHub Actions | docs</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Running scheduled job on GitHub Actions" /> <meta name="author" content="Kamil Figiela" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <meta property="og:description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <link rel="canonical" href="https://soostone.github.io/user-manual/github-actions" /> <meta property="og:url" content="https://soostone.github.io/user-manual/github-actions" /> <meta property="og:site_name" content="docs" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Running scheduled job on GitHub Actions" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Kamil Figiela"},"url":"https://soostone.github.io/user-manual/github-actions","@type":"WebPage","description":"Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://soostone.github.io/assets/images/logo-and-name.svg"},"name":"Kamil Figiela"},"headline":"Running scheduled job on GitHub Actions","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="site-super-header"> <div class="ssh-container"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-nav"> <a class="link-button active" href="#">Documentation</a> <a class="link-button" href="#">Community</a> <a class="link-button" href="#">Features</a> <a class="link-button" href="#">Use Cases</a> <span class="gradient-border"> <a class="link-button " href="#">Install</a> </span> </div> </div> <div class="menu__button" style="-webkit-user-select: text;" aria-label="menu" role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu" aria-expanded="false"> <div class="menu__button-block"> <div class="menu__button-line top"></div> <div class="menu__button-line mid"></div> <div class="menu__button-line bot"></div> </div> </div> </div> </div> <div class="side-bar" style="display: none;"> <div class="site-header"> <a href="https://soostone.github.io/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link active">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </nav> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search docs" aria-label="Search docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div class="btn-sort-cats">Sort Categories <span><img src="/assets/images/down-arrow.svg" alt=""></span>
</div> <div class="side-bar"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link active">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </div> <div class="main-content-lspander"></div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://soostone.github.io/user-manual/">User Manual</a></li> <li class="breadcrumb-nav-list-item"><span>Running scheduled job on GitHub Actions</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="running-scheduled-job-on-github-actions"> <a href="#running-scheduled-job-on-github-actions" class="anchor-heading" aria-labelledby="running-scheduled-job-on-github-actions"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running scheduled job on GitHub Actions </h1> <p>Docker distribution of Napkin makes it easy to deploy it in unattended environments, such as CI/CD platform. In examples below, we will execute Napkin Spec on daily basis using <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a>. This approach can be easily adapted by the user for a CI/CD platform of choice.</p> <h2 id="bigquery"> <a href="#bigquery" class="anchor-heading" aria-labelledby="bigquery"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> BigQuery </h2> <p>In order to pass DB credentials to unattended job, you need to generated credentials file as described in <a href="/user-manual/db-connection#authenticating-for-unattended-runs">Connecting to the database</a> document. Next, you need to add it as <code class="language-plaintext highlighter-rouge">NAPKIN_CREDS</code> secret in <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub repository settings</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Napkin</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">master</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># trigger the workflow daily at 3am</span>
    <span class="c1"># * is a special character in YAML so you have to quote this string</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">napkin</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-20.04</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">soostone/napkin-exe:v0.5.10</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get branch name</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">branch-name</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">tj-actions/branch-names@v5</span>
      <span class="pi">-</span> <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">NAPKIN_CREDS</span><span class="pi">:</span> <span class="s">${{ secrets.NAPKIN_CREDS }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">echo "$NAPKIN_CREDS" &gt; creds.json</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">napkin run --log-format Server -C creds.json --arg branch=${{ steps.branch-name.outputs.current_branch }}</span>

</code></pre></div></div> <h2 id="postgresredshift"> <a href="#postgresredshift" class="anchor-heading" aria-labelledby="postgresredshift"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Postgres/Redshift </h2> <p>Credentials to the database have to be provided, so Napkin is able to connect to the database. In this example, we assume that full connection string is present in the YAML Spec except of DB password. When you add it as <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> secret in <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub repository settings</a> it will be reexported as <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> variable that will be consumed by Postgres client.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Napkin</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">master</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># trigger the workflow daily at 3am</span>
    <span class="c1"># * is a special character in YAML so you have to quote this string</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">napkin</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-20.04</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">soostone/napkin-exe:v0.5.10</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get branch name</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">branch-name</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">tj-actions/branch-names@v5</span>
      <span class="pi">-</span> <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">PGPASSWORD</span><span class="pi">:</span> <span class="s">${{ secrets.PGPASSWORD }}</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">napkin run --log-format Server --arg branch=${{ steps.branch-name.outputs.current_branch }}</span>

</code></pre></div></div> </div> </div> <div class="main-content-rspander"></div> <div class="search-overlay"></div> </div> <footer class="site-footer"> <div class="site-footer-rows"> <div class="site-footer-r1"> <div class="white-napkin"></div> <div class="sf-box"> <div class="sfb-nav"> <div class="link-table"> <a href="#" class="">Documentation</a> <a href="#" class="">Community</a> <a href="#" class="">Features</a> </div> <div class="link-table"> <a href="#" class="">Use Cases</a> <a href="#" class="">About Napkin</a> <a href="#" class="">Contact</a> </div> </div> <div class="gradient-border"> <a href="#" class="link-button">Get Napkin</a> </div> </div> </div> <div class="media-bar"> <span class="media-pad"> <a href="#" class="logo fb-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo twitter-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo linked-in-logo"></a> </span> </div> <div class="site-footer-copy-right"> <div class="copyright"> Copyright 2021 ©    |    <a href="#">Privacy Policy</a> </div> <div class="made-with"> Made with <span class="heart-inline"> </span> in NYC </div> </div> </div> </footer> <div class="sortcat-shadow"> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> <script type="text/javascript" src="/assets/js/highlight-active-link.js"></script> </body> </html>
