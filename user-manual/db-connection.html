<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="manifest" href="/manifest.json" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/main.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/touch-icon/logo-76.png" /> <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/touch-icon/logo-120.png" /> <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/touch-icon/logo-152.png" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/touch-icon/logo-180.png" /> <meta name="msapplication-square70x70logo" content="/assets/images/touch-icon/logo-70.png" /> <meta name="msapplication-square150x150logo" content="/assets/images/touch-icon/logo-150.png" /> <meta name="msapplication-square310x310logo" content="/assets/images/touch-icon/logo-310.png" /> <!-- keywords not used by google but other search engines might still use --> <meta name="keywords" content="Napkin, BigQuery, Postgres, SQL, BigData, Data Scientist, Data Engineer, Analytics" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Connecting to the database | docs</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Connecting to the database" /> <meta name="author" content="Kamil Figiela" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <meta property="og:description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <link rel="canonical" href="https://soostone.github.io/user-manual/db-connection" /> <meta property="og:url" content="https://soostone.github.io/user-manual/db-connection" /> <meta property="og:site_name" content="docs" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Connecting to the database" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Kamil Figiela"},"url":"https://soostone.github.io/user-manual/db-connection","@type":"WebPage","description":"Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://soostone.github.io/assets/images/logo-and-name.svg"},"name":"Kamil Figiela"},"headline":"Connecting to the database","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="site-super-header"> <div class="ssh-container"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-nav"> <a class="link-button active" href="/">Documentation</a> <a class="link-button" href="#">Community</a> <a class="link-button" href="#">Features</a> <a class="link-button" href="#">Use Cases</a> <span class="gradient-border"> <a class="link-button " href="/install">Install</a> </span> </div> </div> <div class="menu__button" style="-webkit-user-select: text;" aria-label="menu" role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu" aria-expanded="false"> <div class="menu__button-block"> <div class="menu__button-line top"></div> <div class="menu__button-line mid"></div> <div class="menu__button-line bot"></div> </div> </div> </div> </div> <div class="side-bar" style="display: none;"> <div class="site-header"> <a href="https://soostone.github.io/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/getting-started/" class="nav-list-link"> Getting started </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#homebrew" class="nav-list-link"> Homebrew </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/yaml-reference" class="nav-list-link">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/mustache" class="nav-list-link">Mustache</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/cli-reference" class="nav-list-link">CLI reference</a></li>
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link active">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/preprocessors" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running as a scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </nav> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search docs" aria-label="Search docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div class="btn-sort-cats">Sort Categories <span><img src="/assets/images/down-arrow.svg" alt=""></span>
</div> <div class="side-bar"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/getting-started/" class="nav-list-link"> Getting started </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#homebrew" class="nav-list-link"> Homebrew </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/fundamentals/" class="nav-list-link"> Fundamentals </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/yaml-reference" class="nav-list-link">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/mustache" class="nav-list-link">Mustache</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/cli-reference" class="nav-list-link">CLI reference</a></li>
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link active">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/preprocessors" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running as a scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </div> <div class="main-content-lspander"></div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://soostone.github.io/user-manual/">User Manual</a></li> <li class="breadcrumb-nav-list-item"><span>Connecting to the database</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="connecting-to-the-database"> <a href="#connecting-to-the-database" class="anchor-heading" aria-labelledby="connecting-to-the-database"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Connecting to the database </h1> <p>Napkin works with a single DB backend and connection string a time. Database connection string has to be configured in YAML spec and it has to match the selected backend. Connection string can be later overridden with <code class="language-plaintext highlighter-rouge">--uri</code> (<code class="language-plaintext highlighter-rouge">-u</code>) flag when spec is executed with <code class="language-plaintext highlighter-rouge">napkin run</code> command.</p> <h2 id="bigquery"> <a href="#bigquery" class="anchor-heading" aria-labelledby="bigquery"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> BigQuery </h2> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">BigQuery</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">bigquery://bigquery.googleapis.com/PROJECT-NAME?dataset=DATASET-NAME</span>
</code></pre></div></div> <p>Database connection string (<code class="language-plaintext highlighter-rouge">db_url</code> in YAML or <code class="language-plaintext highlighter-rouge">--uri</code>) should be formatted as follows: <code class="language-plaintext highlighter-rouge">bigquery://bigquery.googleapis.com/PROJECT-NAME</code>. Furthermore, one can set default dataset by appending <code class="language-plaintext highlighter-rouge">?dataset=DATASET-NAME</code>. Note that authentication credentials are cached for particular Spec YAML path, database connection string and app. If any of them changes you will need to authenticate again. The credentials are cached in <code class="language-plaintext highlighter-rouge">~/.napkin/oauthdb</code> by default, this path can be changed with <code class="language-plaintext highlighter-rouge">--credentials-db</code> argument.</p> <p>Alternatively, one may pass credentials JSON using <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option. This option can be useful when running napkin in unattended configuration.</p> <h3 id="authenticating-locally"> <a href="#authenticating-locally" class="anchor-heading" aria-labelledby="authenticating-locally"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authenticating locally </h3> <p>Run <code class="language-plaintext highlighter-rouge">napkin auth create</code> command and follow the instructions in the web browser.</p> <h3 id="authenticating-for-unattended-runs"> <a href="#authenticating-for-unattended-runs" class="anchor-heading" aria-labelledby="authenticating-for-unattended-runs"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authenticating for unattended runs </h3> <p>First, authenticate locally. Then run <code class="language-plaintext highlighter-rouge">napkin auth show</code> and save value of <code class="language-plaintext highlighter-rouge">OAuth2-JsonToken</code> in a JSON file. The credentials JSON can be later passed to <code class="language-plaintext highlighter-rouge">napkin run</code> using <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option.</p> <p>It may be then stored in a secret store of CI/CD platform of choice. Please refer to <a href="/user-manual/github-actions">GitHub Actions example</a> for further reference.</p> <h2 id="postgresql-and-redshift"> <a href="#postgresql-and-redshift" class="anchor-heading" aria-labelledby="postgresql-and-redshift"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Postgresql and Redshift </h2> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">Postgres</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://user@db/napkin_db</span>
</code></pre></div></div> <p>Connection for Postgres and Redshift, which uses Postgres protocol, can be configured with connection string and/or environment variables. Connection strings use standard syntax from libpq and can be summarized with the following examples:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgresql://
postgresql://localhost
postgresql://localhost:5433
postgresql://localhost/mydb
postgresql://user@localhost
postgresql://user:secret@localhost
</code></pre></div></div> <p>Values that are not provided in the connection string will be sourced from environment variables if available. If <code class="language-plaintext highlighter-rouge">postgresql://</code> connection string is used whole database connection configuration will be sourced from environment variables. This can be useful in unattended environments. For more examples and further reference on <a href="https://www.postgresql.org/docs/14/libpq-connect.html#LIBPQ-CONNSTRING" target="_blank" rel="noopener noreferrer">connection string</a> and <a href="https://www.postgresql.org/docs/14/libpq-envars.html" target="_blank" rel="noopener noreferrer">environment variables</a> please visit libpq manual.</p> <p>We do not recommend storing any passwords in the YAML spec. Instead, one can:</p> <ul> <li>store the password in a text file, then pass the file location with <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option,</li> <li>store the password in a text file, then pass the file location with <code class="language-plaintext highlighter-rouge">PGPASSFILE</code> environment variable,</li> <li>provide the password with the <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> environment variable.</li> </ul> <h2 id="sqlite"> <a href="#sqlite" class="anchor-heading" aria-labelledby="sqlite"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sqlite </h2> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:some-folder/dbfile.db</span>
</code></pre></div></div> <p>Connection string is a path to the database file (with <code class="language-plaintext highlighter-rouge">sqlite:</code> prefix).</p> </div> </div> <div class="main-content-rspander"></div> <div class="search-overlay"></div> </div> <footer class="site-footer"> <div class="site-footer-rows"> <div class="site-footer-r1"> <div class="white-napkin"></div> <div class="sf-box"> <div class="sfb-nav"> <div class="link-table"> <a href="#" class="">Documentation</a> <a href="#" class="">Community</a> <a href="#" class="">Features</a> </div> <div class="link-table"> <a href="#" class="">Use Cases</a> <a href="#" class="">About Napkin</a> <a href="#" class="">Contact</a> </div> </div> <div class="gradient-border"> <a href="#" class="link-button">Get Napkin</a> </div> </div> </div> <div class="media-bar"> <span class="media-pad"> <a href="#" class="logo fb-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo twitter-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo linked-in-logo"></a> </span> </div> <div class="site-footer-copy-right"> <div class="copyright"> Copyright 2022 ©    |    <a href="#">Privacy Policy</a> </div> <div class="made-with"> Made with <span class="heart-inline"> </span> in NYC </div> </div> </div> </footer> <div class="sortcat-shadow"> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> <script type="text/javascript" src="/assets/js/highlight-active-link.js"></script> </body> </html>
