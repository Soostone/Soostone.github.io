<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Running as a scheduled job on GitHub Actions</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Running as a scheduled job on GitHub Actions" /> <meta name="author" content="Kamil Figiela" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <meta property="og:description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems." /> <link rel="canonical" href="https://soostone.github.io/user-manual/github-actions/" /> <meta property="og:url" content="https://soostone.github.io/user-manual/github-actions/" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Running as a scheduled job on GitHub Actions" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Kamil Figiela"},"url":"https://soostone.github.io/user-manual/github-actions/","@type":"WebPage","description":"Napkin tutorials for data scientists and analytics using BigQuery, Postgres and other NoSql/SQL systems.","headline":"Running as a scheduled job on GitHub Actions","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/js/resize.js"></script> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list">
<li class="nav-list-item"><a href="https://soostone.github.io/" class="nav-list-link">About</a></li>
<li class="nav-list-item"><a href="https://soostone.github.io/getting-started/" class="nav-list-link">Getting started</a></li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://soostone.github.io/install/" class="nav-list-link">Installation</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/install#native" class="nav-list-link">Native</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/install#homebrew" class="nav-list-link">Homebrew</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/install#docker" class="nav-list-link">Docker</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/install#cachix" class="nav-list-link">Cachix</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="https://soostone.github.io/fundamentals/" class="nav-list-link">Fundamentals</a></li>
<li class="nav-list-item"><a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link">Tips and Tricks</a></li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://soostone.github.io/user-manual/" class="nav-list-link">User Manual</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/mustache/" class="nav-list-link">Mustache Interpolation</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/yaml-reference/" class="nav-list-link">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/spec-arguments/" class="nav-list-link">Spec arguments</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection/" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/docker/" class="nav-list-link">Docker</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/cli-reference/" class="nav-list-link">CLI reference</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment/" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer/" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/preprocessors/" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item active"><a href="https://soostone.github.io/user-manual/github-actions/" class="nav-list-link active">Running as a scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://soostone.github.io/metaprogramming/" class="nav-list-link">Metaprogramming</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/metaprogramming/repl/" class="nav-list-link">REPL</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/metaprogramming/custom-hooks/" class="nav-list-link">Writing Custom Hooks</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/metaprogramming/haskell/" class="nav-list-link">Haskell API</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="https://soostone.github.io/haddock/" class="nav-list-link">API Reference</a></li>
<li class="nav-list-item"><a href="https://soostone.github.io/changelog/" class="nav-list-link">Changelog</a></li>
<li class="nav-list-item"><a href="https://soostone.github.io/ide/" class="nav-list-link">IDE Support</a></li>
</ul> </nav> </div> <div class="site-super-header"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-buttons"> <a class="link-button active" href="/">Documentation</a> <a class="link-button" href="https://napkinweb.webflow.io/community" target="_blank" rel="noopener noreferrer">Community</a> <a class="link-button" href="https://napkinweb.webflow.io/features" target="_blank" rel="noopener noreferrer">Features</a> <a class="link-button" href="https://napkinweb.webflow.io/usecases" target="_blank" rel="noopener noreferrer">Use Cases</a> <span class="gradient-border"> <a class="link-button" href="/install/">Install</a> </span> </div> </div> </div> <div class="width-ruler"></div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://soostone.github.io/user-manual/">User Manual</a></li> <li class="breadcrumb-nav-list-item"><span>Running as a scheduled job on GitHub Actions</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="running-as-a-scheduled-job-on-github-actions">Running as a scheduled job on GitHub Actions</h1> <p>Docker distribution of Napkin makes it easy to deploy it in unattended environments, such as CI/CD platform. In the examples below, we will execute Napkin Spec on daily basis using <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions</a>. This approach can be easily adapted by the user for a CI/CD platform of choice.</p> <div class="premonition note"> <i class="premonition pn-note"></i> <div class="content"> <p>Some Napkin features require the metadata store to be persisted between Spec runs. We recommend configuring a Postgres database as a metadata store. Alternatively, one needs to persist Sqlite metadata store between job runs.</p> </div> </div> <h2 id="bigquery">BigQuery</h2> <p>In order to pass DB credentials to unattended job, you need to generated credentials file as described in <a href="/user-manual/db-connection/#authenticating-for-unattended-runs">Connecting to the database</a> document. Next, you need to add it as <code class="language-plaintext highlighter-rouge">NAPKIN_CREDS</code> secret in <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub repository settings</a>.</p> <div class="language-yaml copyable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Napkin</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">master</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># trigger the workflow daily at 3 am</span>
    <span class="c1"># * is a special character in YAML so you have to quote this string</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">napkin</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-20.04</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">soostone/napkin-exe:v0.5.10</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get branch name</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">branch-name</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">tj-actions/branch-names@v5</span>
      <span class="pi">-</span> <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">NAPKIN_CREDS</span><span class="pi">:</span> <span class="s">${{ secrets.NAPKIN_CREDS }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">echo "$NAPKIN_CREDS" &gt; creds.json</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">napkin run --log-format Server -C creds.json --arg branch=${{ steps.branch-name.outputs.current_branch }}</span>

</code></pre></div></div> <h2 id="postgresredshift">Postgres/Redshift</h2> <p>Credentials to the database have to be provided, so Napkin can connect to the database. In this example, we assume that the full connection string is present in the YAML Spec except for the DB password. When you add it as <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> secret in <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub repository settings</a> it will be reexported as <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> variable that will be consumed by the Postgres client.</p> <div class="language-yaml copyable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Napkin</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">master</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="c1"># trigger the workflow daily at 3 am</span>
    <span class="c1"># * is a special character in YAML so you have to quote this string</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">napkin</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-20.04</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">soostone/napkin-exe:v0.5.10</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get branch name</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">branch-name</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">tj-actions/branch-names@v5</span>
      <span class="pi">-</span> <span class="na">shell</span><span class="pi">:</span> <span class="s">bash</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">PGPASSWORD</span><span class="pi">:</span> <span class="s">${{ secrets.PGPASSWORD }}</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">napkin run --log-format Server --arg branch=${{ steps.branch-name.outputs.current_branch }}</span>

</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> <div class="site-super-footer"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-buttons"> <div class="table-wrapper"><table> <tr> <td> <a class="link-button active" href="/">Documentation</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/usecases" target="_blank" rel="noopener noreferrer">Use Cases</a> </td> <td> <span class="gradient-border"> <a class="link-button" href="/install/">Get Napkin</a> </span> </td> </tr> <tr> <td> <a class="link-button" href="https://napkinweb.webflow.io/community" target="_blank" rel="noopener noreferrer">Community</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/about" target="_blank" rel="noopener noreferrer">About Napkin</a> </td> </tr> <tr> <td> <a class="link-button" href="https://napkinweb.webflow.io/features" target="_blank" rel="noopener noreferrer">Features</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/contact" target="_blank" rel="noopener noreferrer">Contact</a> </td> </tr> </table></div> </div> <div class="media-bar"> <div class="media-pad"><a href="#" class="inline-icon facebook"></a></div> <div class="media-pad"><a href="#" class="inline-icon twitter"></a></div> <div class="media-pad"><a href="#" class="inline-icon linked-in"></a></div> </div> <div class="copyright"> <div class="left"> Copyright 2022 © </div> <div class="right"> Made with <span class="heart"> </span> in NYC </div> </div> </div> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> </body> </html>
