<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Connecting to the database</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Connecting to the database" /> <meta name="author" content="Kamil Figiela" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres, Sqlite and other NoSql/SQL systems." /> <meta property="og:description" content="Napkin tutorials for data scientists and analytics using BigQuery, Postgres, Sqlite and other NoSql/SQL systems." /> <link rel="canonical" href="https://docs.napkin.run/user-manual/db-connection/" /> <meta property="og:url" content="https://docs.napkin.run/user-manual/db-connection/" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Connecting to the database" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kamil Figiela"},"description":"Napkin tutorials for data scientists and analytics using BigQuery, Postgres, Sqlite and other NoSql/SQL systems.","headline":"Connecting to the database","url":"https://docs.napkin.run/user-manual/db-connection/"}</script> <!-- End Jekyll SEO tag --> <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> <script type="text/javascript" src="/assets/js/resize.js"></script> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list">
<li class="nav-list-item"><a href="https://docs.napkin.run/" class="nav-list-link">About</a></li>
<li class="nav-list-item"><a href="https://docs.napkin.run/getting-started/" class="nav-list-link">Getting started</a></li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://docs.napkin.run/install/" class="nav-list-link">Installation</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://docs.napkin.run/install#native" class="nav-list-link">Native</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/install#homebrew" class="nav-list-link">Homebrew</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/install#docker" class="nav-list-link">Docker</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/install#cachix" class="nav-list-link">Cachix</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="https://docs.napkin.run/fundamentals/" class="nav-list-link">Fundamentals</a></li>
<li class="nav-list-item"><a href="https://docs.napkin.run/tips-and-tricks/" class="nav-list-link">Tips and Tricks</a></li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://docs.napkin.run/user-manual/" class="nav-list-link">User Manual</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/cli-reference/" class="nav-list-link">CLI reference</a></li>
<li class="nav-list-item active"><a href="https://docs.napkin.run/user-manual/db-connection/" class="nav-list-link active">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/devcontainer/" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/docker/" class="nav-list-link">Docker</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/ide/" class="nav-list-link">IDE Support</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/multi-environment/" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/mustache/" class="nav-list-link">Mustache Interpolation</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/preprocessors/" class="nav-list-link">Preprocessors</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/github-actions/" class="nav-list-link">Running as a scheduled job on GitHub Actions</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/yaml-reference/" class="nav-list-link">Spec YAML reference</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/user-manual/spec-arguments/" class="nav-list-link">Spec arguments</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://docs.napkin.run/metaprogramming/" class="nav-list-link">Metaprogramming</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://docs.napkin.run/metaprogramming/haskell/" class="nav-list-link">Haskell API</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/metaprogramming/repl/" class="nav-list-link">REPL</a></li>
<li class="nav-list-item "><a href="https://docs.napkin.run/metaprogramming/custom-hooks/" class="nav-list-link">Writing Custom Hooks</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="https://docs.napkin.run/haddock/" class="nav-list-link">API Reference</a></li>
<li class="nav-list-item"><a href="https://docs.napkin.run/changelog/" class="nav-list-link">Changelog</a></li>
</ul> </nav> </div> <div class="site-super-header"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-buttons"> <a class="link-button active" href="/">Documentation</a> <a class="link-button" href="https://napkinweb.webflow.io/community" target="_blank" rel="noopener noreferrer">Community</a> <a class="link-button" href="https://napkinweb.webflow.io/features" target="_blank" rel="noopener noreferrer">Features</a> <a class="link-button" href="https://napkinweb.webflow.io/usecases" target="_blank" rel="noopener noreferrer">Use Cases</a> <span class="gradient-border"> <a class="link-button" href="/install/">Install</a> </span> </div> </div> </div> <div class="width-ruler"></div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://docs.napkin.run/user-manual/">User Manual</a></li> <li class="breadcrumb-nav-list-item"><span>Connecting to the database</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="connecting-to-the-database">Connecting to the database</h1> <p>Napkin works with a single DB backend and connection string a time. Database connection string has to be configured in YAML spec and it has to match the selected backend. Connection string can be later overridden with <code class="language-plaintext highlighter-rouge">--uri</code> (<code class="language-plaintext highlighter-rouge">-u</code>) flag when spec is executed with <code class="language-plaintext highlighter-rouge">napkin run</code> command.</p> <h2 id="bigquery">BigQuery</h2> <div class="language-yaml copyable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">BigQuery</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">bigquery://bigquery.googleapis.com/PROJECT-NAME?dataset=DATASET-NAME</span>
</code></pre></div></div> <p>Database connection string (<code class="language-plaintext highlighter-rouge">db_url</code> in YAML or <code class="language-plaintext highlighter-rouge">--uri</code>) should be formatted as follows: <code class="language-plaintext highlighter-rouge">bigquery://bigquery.googleapis.com/PROJECT-NAME</code>. Furthermore, one can set default dataset by appending <code class="language-plaintext highlighter-rouge">?dataset=DATASET-NAME</code>. Note that authentication credentials are cached for particular Spec YAML path, database connection string and app. If any of them changes you will need to authenticate again. The credentials are cached in <code class="language-plaintext highlighter-rouge">~/.napkin/oauthdb</code> by default, this path can be changed with <code class="language-plaintext highlighter-rouge">--credentials-db</code> argument.</p> <p>Alternatively, one may pass credentials JSON using <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option. This option can be useful when running napkin in unattended configuration.</p> <h3 id="authenticating-locally">Authenticating locally</h3> <p>Run <code class="language-plaintext highlighter-rouge">napkin auth create</code> command and follow the instructions in the web browser.</p> <h3 id="authenticating-for-unattended-runs">Authenticating for unattended runs</h3> <p>First, authenticate locally. Then run <code class="language-plaintext highlighter-rouge">napkin auth show</code> and save value of <code class="language-plaintext highlighter-rouge">OAuth2-JsonToken</code> in a JSON file. The credentials JSON can be later passed to <code class="language-plaintext highlighter-rouge">napkin run</code> using <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option.</p> <p>It may be then stored in a secret store of CI/CD platform of choice. Please refer to <a href="/user-manual/github-actions/">GitHub Actions example</a> for further reference.</p> <h2 id="postgresql-and-redshift">Postgresql and Redshift</h2> <div class="language-yaml copyable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">Postgres</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://user@db/napkin_db</span>
</code></pre></div></div> <p>Connection for Postgres and Redshift, which uses Postgres protocol, can be configured with connection string and/or environment variables. Connection strings use standard syntax from libpq and can be summarized with the following examples:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgresql://
postgresql://localhost
postgresql://localhost:5433
postgresql://localhost/mydb
postgresql://user@localhost
postgresql://user:secret@localhost
</code></pre></div></div> <p>Values that are not provided in the connection string will be sourced from environment variables if available. If <code class="language-plaintext highlighter-rouge">postgresql://</code> connection string is used whole database connection configuration will be sourced from environment variables. This can be useful in unattended environments. For more examples and further reference on <a href="https://www.postgresql.org/docs/14/libpq-connect.html#LIBPQ-CONNSTRING" target="_blank" rel="noopener noreferrer">connection string</a> and <a href="https://www.postgresql.org/docs/14/libpq-envars.html" target="_blank" rel="noopener noreferrer">environment variables</a> please visit libpq manual.</p> <p>We do not recommend storing any passwords in the YAML spec. Instead, one can:</p> <ul> <li>store the password in a text file, then pass the file location with <code class="language-plaintext highlighter-rouge">--credentials-file</code> (<code class="language-plaintext highlighter-rouge">-C</code>) option,</li> <li>store the password in a text file, then pass the file location with <code class="language-plaintext highlighter-rouge">PGPASSFILE</code> environment variable,</li> <li>provide the password with the <code class="language-plaintext highlighter-rouge">PGPASSWORD</code> environment variable.</li> </ul> <h2 id="sqlite">Sqlite</h2> <div class="language-yaml copyable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">backend</span><span class="pi">:</span> <span class="s">Sqlite</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">sqlite:some-folder/dbfile.db</span>
</code></pre></div></div> <p>Connection string is a path to the database file (with <code class="language-plaintext highlighter-rouge">sqlite:</code> prefix).</p> </div> </div> <div class="search-overlay"></div> </div> <div class="site-super-footer"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-buttons"> <div class="table-wrapper"><table> <tr> <td> <a class="link-button active" href="/">Documentation</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/usecases" target="_blank" rel="noopener noreferrer">Use Cases</a> </td> <td> <span class="gradient-border"> <a class="link-button" href="/install/">Get Napkin</a> </span> </td> </tr> <tr> <td> <a class="link-button" href="https://napkinweb.webflow.io/community" target="_blank" rel="noopener noreferrer">Community</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/about" target="_blank" rel="noopener noreferrer">About Napkin</a> </td> </tr> <tr> <td> <a class="link-button" href="https://napkinweb.webflow.io/features" target="_blank" rel="noopener noreferrer">Features</a> </td> <td> <a class="link-button" href="https://napkinweb.webflow.io/contact" target="_blank" rel="noopener noreferrer">Contact</a> </td> </tr> </table></div> </div> <div class="media-bar"> <div class="media-pad"><a href="#" class="inline-icon facebook"></a></div> <div class="media-pad"><a href="#" class="inline-icon twitter"></a></div> <div class="media-pad"><a href="#" class="inline-icon linked-in"></a></div> </div> <div class="copyright"> <div class="left"> Copyright 2022 © </div> <div class="right"> Made with <span class="heart"> </span> in NYC </div> </div> </div> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> </body> </html>
