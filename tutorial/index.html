<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="manifest" href="/manifest.json" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/main.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/touch-icon/logo-76.png" /> <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/touch-icon/logo-120.png" /> <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/touch-icon/logo-152.png" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/touch-icon/logo-180.png" /> <meta name="msapplication-square70x70logo" content="/assets/images/touch-icon/logo-70.png" /> <meta name="msapplication-square150x150logo" content="/assets/images/touch-icon/logo-150.png" /> <meta name="msapplication-square310x310logo" content="/assets/images/touch-icon/logo-310.png" /> <!-- keywords not used by google but other search engines might still use --> <meta name="keywords" content="Napkin, BigQuery, Postgres, SQL, BigData, Data Scientist, Data Engineer, Analytics" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Tutorial | docs</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Tutorial" /> <meta name="author" content="Kayvan Kazeminejad" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Tutorial a new Napkin user with examples showing all features and usecases." /> <meta property="og:description" content="Tutorial a new Napkin user with examples showing all features and usecases." /> <link rel="canonical" href="https://soostone.github.io/tutorial/" /> <meta property="og:url" content="https://soostone.github.io/tutorial/" /> <meta property="og:site_name" content="docs" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Tutorial" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Kayvan Kazeminejad"},"headline":"Tutorial","url":"https://soostone.github.io/tutorial/","description":"Tutorial a new Napkin user with examples showing all features and usecases.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://soostone.github.io/assets/images/logo-and-name.svg"},"name":"Kayvan Kazeminejad"},"@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="site-super-header"> <div class="ssh-container"> <div class="super-nav-box"> <div class="site-logo"></div> <div class="site-nav"> <a class="link-button active" href="#">Documentation</a> <a class="link-button" href="#">Community</a> <a class="link-button" href="#">Features</a> <a class="link-button" href="#">Use Cases</a> <span class="gradient-border"> <a class="link-button " href="#">Install</a> </span> </div> </div> <div class="menu__button" style="-webkit-user-select: text;" aria-label="menu" role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu" aria-expanded="false"> <div class="menu__button-block"> <div class="menu__button-line top"></div> <div class="menu__button-line mid"></div> <div class="menu__button-line bot"></div> </div> </div> </div> </div> <div class="side-bar" style="display: none;"> <div class="site-header"> <a href="https://soostone.github.io/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/Funamentals/" class="nav-list-link"> Fundamentas </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </nav> </div> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search docs" aria-label="Search docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main" id="top"> <div class="btn-sort-cats">Sort Categories <span><img src="/assets/images/down-arrow.svg" alt=""></span>
</div> <div class="side-bar"> <ul class="nav-list"> <li class="nav-list-item" style="display: none;"> <a class="nav-list-link" href="https://napkinweb.webflow.io/" target="_blank" rel="noopener noreferrer"> Napkin product </a> </li>
<li class="nav-list-item">
<a href="https://soostone.github.io/" class="nav-list-link"> About </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/install/" class="nav-list-link"> Installation </a> <ul>
<li> <a href="/install/#native" class="nav-list-link"> Native </a> </li>
<li> <a href="/install/#docker" class="nav-list-link"> Docker </a> </li>
<li> <a href="/install/#cachix" class="nav-list-link"> Cachix </a> </li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/Funamentals/" class="nav-list-link"> Fundamentas </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tutorial/" class="nav-list-link"> Tutorial </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/tips-and-tricks/" class="nav-list-link"> Tips and Tricks </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/docker/" class="nav-list-link"> Docker </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="https://soostone.github.io/user-manual/" class="nav-list-link"> User Manual </a> <ul></ul>
<ul class="nav-list ">
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/multi-environment" class="nav-list-link">Multi-environment pipelines in a team setting</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/db-connection" class="nav-list-link">Connecting to the database</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/devcontainer" class="nav-list-link">Devcontainer</a></li>
<li class="nav-list-item "><a href="https://soostone.github.io/user-manual/github-actions" class="nav-list-link">Running scheduled job on GitHub Actions</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/changelog/" class="nav-list-link"> Changelog </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/haddock/" class="nav-list-link"> API Reference </a> <ul></ul>
</li>
<li class="nav-list-item">
<a href="https://soostone.github.io/ide" class="nav-list-link"> IDE Support </a> <ul></ul>
</li>
</ul> </div> <div class="main-content-lspander"></div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <ol id="markdown-toc"> <li>
<a href="#tutorial" id="markdown-toc-tutorial">Tutorial</a> <ol> <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li> <li><a href="#interacting-with-napkin---the-spec" id="markdown-toc-interacting-with-napkin---the-spec">Interacting with Napkin - The Spec</a></li> <li><a href="#create-a-minimal-napkin-project" id="markdown-toc-create-a-minimal-napkin-project">Create a minimal napkin project</a></li> <li>
<a href="#workflow" id="markdown-toc-workflow">Workflow</a> <ol> <li><a href="#source-tables-and-corresponding-data" id="markdown-toc-source-tables-and-corresponding-data">Source tables and corresponding data</a></li> <li><a href="#extending-napkin-spec" id="markdown-toc-extending-napkin-spec">Extending Napkin Spec</a></li> <li><a href="#processing-new-incoming-data" id="markdown-toc-processing-new-incoming-data">Processing new incoming data</a></li> </ol> </li> <li><a href="#using-templates-and-variable-interpolation" id="markdown-toc-using-templates-and-variable-interpolation">Using Templates and Variable Interpolation</a></li> <li>
<a href="#misc" id="markdown-toc-misc">Misc</a> <ol> <li><a href="#unused-column-detection" id="markdown-toc-unused-column-detection">Unused column detection</a></li> </ol> </li> <li><a href="#more-resources" id="markdown-toc-more-resources">More resources</a></li> <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li> </ol> </li> </ol> <h1 id="tutorial"> <a href="#tutorial" class="anchor-heading" aria-labelledby="tutorial"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tutorial </h1> <p>Napkin is a data pipeline automation tool, designed to execute a series of <code class="language-plaintext highlighter-rouge">.SQL</code> queries where the resultant data is utilized to create downstream tables. Napkin currently supported backends are:</p> <ul> <li><a href="https://cloud.google.com/bigquery" target="_blank" rel="noopener noreferrer">BigQuery</a></li> <li><a href="https://aws.amazon.com/redshift" target="_blank" rel="noopener noreferrer">Redshift</a></li> <li><a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">Postgres</a></li> <li><a href="https://www.sqlite.org/index.html" target="_blank" rel="noopener noreferrer">SQLite</a></li> </ul> <p>In this hands-on tutorial we first use Napkin’s intuitive interface, <strong>Spec</strong>, to bootstrap and execute a simple SQL data pipeline. Next, we modify <code class="language-plaintext highlighter-rouge">Napkin Spec</code> to add additional computations to the data pipeline.</p> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <ul> <li>Napkin should be <a href="/install">installed</a>
</li> <li>Access to <a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL</a> instance</li> </ul> <h2 id="interacting-with-napkin---the-spec"> <a href="#interacting-with-napkin---the-spec" class="anchor-heading" aria-labelledby="interacting-with-napkin---the-spec"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interacting with Napkin - The Spec </h2> <p><strong>Spec</strong>, a high level <a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank" rel="noopener noreferrer">DSL</a> in <a href="https://en.wikipedia.org/wiki/YAML" target="_blank" rel="noopener noreferrer">YAML</a> configuration language, is the interface to Napkin. In other words, Napkin Spec is simply a <code class="language-plaintext highlighter-rouge">yaml-file</code>. Napkin follows a common paradigm where source tables are never mutated. Instead, Napkin can continuously execute and create a series of dependent tables as new data comes into one or many source tables.</p> <p>The sql files/tables in the Napkin Spec comprise an implicit <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_blank" rel="noopener noreferrer">DAG</a>, where edges are references to fields from other tables.</p> <p>A common use case is as follows:</p> <ul> <li>Source tables are created or updated manually via a data extract or automatically by a piece of software</li> <li>
<code class="language-plaintext highlighter-rouge">.SQL</code> files are written to mutate the data into the desired shape that is fit for use in new, downstream tables (never modifying the source data)</li> <li>A Napkin Spec is created to execute these <code class="language-plaintext highlighter-rouge">.SQL</code> files automatically, repeatedly and in the correct dependency order</li> <li>As new data comes in, the Napkin Spec can be manually or automatically run to recreate the dependent tables with the new data for ongoing use</li> </ul> <p>In this tutorial, first, we utilize Napkin to author a SQL processing pipelines by:</p> <ul> <li>creating the necessary source tables and corresponding data</li> <li>bootstrapping a napkin project</li> <li>authoring and executing Napkin Spec</li> </ul> <p>We then make incremental enhancements to our SQL workflow and modify the Napkin Spec accordingly to execute the pipeline.</p> <h2 id="create-a-minimal-napkin-project"> <a href="#create-a-minimal-napkin-project" class="anchor-heading" aria-labelledby="create-a-minimal-napkin-project"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a minimal napkin project </h2> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin init <span class="nt">--project-name</span> sales-db
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Initialized empty Git repository in /home/soostone/dev/napkin-projects/sales-db-2/tmp/napkin-dev/sales-db/.git/
</code></pre></div></div> <div class="premonition note"> <i class="premonition pn-note"></i> <div class="content"> <p>Note: <code class="language-plaintext highlighter-rouge">napkin generate-spec</code> is capable of generating the Napkin Spec from existing SQL workflow. For the purpose of this tutorial, we opt out on this capability in favor of <code class="language-plaintext highlighter-rouge">napkin init</code> command. This will allow us to build the Napkin Spec incrementally while building our intuition on Napkin and Napkin workflow.</p> </div> </div> <p>The <code class="language-plaintext highlighter-rouge">napkin init</code> command creates a new Napkin project with the following directory structure:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sales-db
├── hie.yaml
├── README.md
├── specs
│   └── spec.yaml
└── sql
    └── example.sql
</code></pre></div></div> <p>Next, we execute our minimal Napkin Spec</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>sales-db
napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">][</span><span class="nl">table:</span><span class="s">"example"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Error</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">][</span><span class="nl">Error:</span><span class="n">NapkinEffectError_FatalError</span> <span class="s">"libpq: failed (could not translate host name \"host\" to address: Temporary failure in name resolution\n)"</span><span class="o">][</span><span class="nl">table:</span><span class="s">"example"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">raised</span> <span class="n">an</span> <span class="n">error</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Error</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"example"</span> <span class="n">raised</span> <span class="n">an</span> <span class="nl">error:</span> <span class="nl">libpq:</span> <span class="n">failed</span> <span class="o">(</span><span class="n">could</span> <span class="n">not</span> <span class="n">translate</span> <span class="n">host</span> <span class="n">name</span> <span class="s">"host"</span> <span class="n">to</span> <span class="nl">address:</span> <span class="nc">Temporary</span> <span class="n">failure</span> <span class="n">in</span> <span class="n">name</span> <span class="n">resolution</span>
<span class="o">)</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">43</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3511168</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span>
</code></pre></div></div> <p>The expected error indicates that Napkin could not <strong>connect to the database</strong>. To resolve the error, we’ll modify the Napkin Spec, <code class="language-plaintext highlighter-rouge">specs/spec.yaml</code>, with the correct database connection <a href="https://www.postgresql.org/docs/8.1/ecpg-connect.html" target="_blank" rel="noopener noreferrer">URL</a>:</p> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://myUserId:myPassword@localhost/salesdb</span>
</code></pre></div></div> <p>Next we Validate the spec file,</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin validate <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
</code></pre></div></div> <p>And finally, we are ready to execute our Napkin project:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">][</span><span class="nl">table:</span><span class="s">"example"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">][</span><span class="nl">table:</span><span class="s">"example"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">15</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"example"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">50</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"example"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">:</span> <span class="mi">50</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">19</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3527014</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span> <span class="mi">50</span> <span class="n">rows</span> <span class="n">affected</span>
</code></pre></div></div> <div class="premonition warning"> <i class="premonition pn-warn"></i> <div class="content"> <p class="header">Assumption</p>
<p>You have all required privileges to PostgreSQL database <code class="language-plaintext highlighter-rouge">salesdb</code></p> </div> </div> <h2 id="workflow"> <a href="#workflow" class="anchor-heading" aria-labelledby="workflow"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Workflow </h2> <p>In this section we’ll extend our Napkin Spec to create a SQL data pipeline. This will require:</p> <ul> <li>create source tables</li> <li>create dependent queries to set up the data pipeline</li> <li>extend <code class="language-plaintext highlighter-rouge">spec/spec.yaml</code> to execute pipelines</li> </ul> <p>We start by creating the source tables first.</p> <div class="premonition warning"> <i class="premonition pn-warn"></i> <div class="content"> <p class="header">Assumption</p>
<p>The upcoming sections assume you have installed and configure <a href="https://www.postgresql.org/docs/13/runtime-config.html" target="_blank" rel="noopener noreferrer">psql</a></p> </div> </div> <h3 id="source-tables-and-corresponding-data"> <a href="#source-tables-and-corresponding-data" class="anchor-heading" aria-labelledby="source-tables-and-corresponding-data"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Source tables and corresponding data </h3> <p>Source tables are input to the Napkin SQL pipeline and are not mutated. Napkin utilizes them to create downstream tables.</p> <p>To create the source tables:</p> <h4 id="input-schema-sql" class="top-code-caption"> <a href="#input-schema-sql" class="anchor-heading" aria-labelledby="input-schema-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> input-schema.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">product</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sale</span><span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">quantity</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">product_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">);</span>
</code></pre></div></div> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nt">-f</span> input-schema.sql salesDb
</code></pre></div></div> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span>
<span class="k">CREATE</span> <span class="k">TABLE</span>
</code></pre></div></div> <p>Next, we add some data to the tables:</p> <h4 id="input-data-sql" class="top-code-caption"> <a href="#input-data-sql" class="anchor-heading" aria-labelledby="input-data-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> input-data.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">product</span> <span class="k">VALUES</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>   <span class="s1">'chocolate bar'</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>   <span class="s1">'coke'</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span>  <span class="s1">'kale'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">sale</span> <span class="k">VALUES</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>   <span class="mi">3</span><span class="p">);</span>
</code></pre></div></div> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nt">-f</span> input-data.sql salesDb
</code></pre></div></div> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">3</span>
<span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">4</span>
</code></pre></div></div> <p>Then, we create the SQL query files, <code class="language-plaintext highlighter-rouge">./sql/best-seller.sql</code> and <code class="language-plaintext highlighter-rouge">./sql/best-revenue.sql</code> in the <code class="language-plaintext highlighter-rouge">./sql/</code> folder:</p> <h4 id="sql-best-seller-sql" class="top-code-caption"> <a href="#sql-best-seller-sql" class="anchor-heading" aria-labelledby="sql-best-seller-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/best-seller.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">product_id</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">sale</span>
 <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">product_id</span>
 <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div></div> <h4 id="sql-best-revenue-sql" class="top-code-caption"> <a href="#sql-best-revenue-sql" class="anchor-heading" aria-labelledby="sql-best-revenue-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/best-revenue.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">product_id</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">price</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="n">quantity</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">sale</span> <span class="n">s</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">product</span> <span class="n">p</span> <span class="k">ON</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
 <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">product_id</span>
 <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div></div> <p>Our project directory structure should resemble:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sales-db
├── data
│   └── napkin.v2.sqlite3
├── hie.yaml
├── README.md
├── specs
│   └── spec.yaml
└── sql
    ├── best-revenue.sql
    ├── best-seller.sql
    └── example.sql
</code></pre></div></div> <p>We are now ready to extend Napkin Spec to create our SQL data pipelines.</p> <h3 id="extending-napkin-spec"> <a href="#extending-napkin-spec" class="anchor-heading" aria-labelledby="extending-napkin-spec"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extending Napkin Spec </h3> <p>To extend Napkin for executing the pipeline, we’ll modify <code class="language-plaintext highlighter-rouge">./specs/spec.yaml</code> from:</p> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=https://soostone-napkin-public.s3.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Postgres</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://myUserName:myPassword@localhost/salesdb</span>
<span class="c1"># set your password by providing it using --uri or set PGPASSWORD variable</span>

<span class="c1"># backend: BigQuery</span>
<span class="c1"># db_url: bigquery://google/project_name?dataset=default_dataset_name</span>
<span class="c1"># Run `napkin auth` to obtain authentication token</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="na">example</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">example.sql</span>
</code></pre></div></div> <p>to:</p> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=https://soostone-napkin-public.s3.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Postgres</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://myUserName:myPassword@localhost/salesdb</span>
<span class="c1"># set your password by providing it using --uri or set PGPASSWORD variable</span>

<span class="na">sql_folder</span><span class="pi">:</span> <span class="s">../sql</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="na">best-seller</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">best-seller.sql</span>
  <span class="na">best-revenue</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">best-revenue.sql</span>
</code></pre></div></div> <p>We then <code class="language-plaintext highlighter-rouge">validate</code> the Spec to make sure we didn’t make any mistakes:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin validate <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
</code></pre></div></div> <p>Next we execute the Spec, and hence the SQL pipeline:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">.</span>
<span class="nl">NOTICE:</span>  <span class="n">table</span> <span class="s">"best-revenue"</span> <span class="n">does</span> <span class="n">not</span> <span class="n">exist</span><span class="o">,</span> <span class="n">skipping</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="nl">NOTICE:</span>  <span class="n">table</span> <span class="s">"best-seller"</span> <span class="n">does</span> <span class="n">not</span> <span class="n">exist</span><span class="o">,</span> <span class="n">skipping</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-revenue"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-seller"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-revenue"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.03</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-seller"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">57</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3604842</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span> <span class="mi">6</span> <span class="n">rows</span> <span class="n">affected</span>
</code></pre></div></div> <p>And finally we verify the pipeline results:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'select * from "best-seller";'</span> | psql
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">product_id</span> <span class="o">|</span> <span class="n">sum</span>
<span class="o">------------+------</span>
          <span class="mi">1</span> <span class="o">|</span> <span class="mi">1000</span>
          <span class="mi">2</span> <span class="o">|</span>  <span class="mi">300</span>
          <span class="mi">3</span> <span class="o">|</span>   <span class="mi">12</span>
<span class="o">(</span><span class="mi">3</span> <span class="n">rows</span><span class="o">)</span>
</code></pre></div></div> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'select * from "best-revenue";'</span> | psql
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">product_id</span> <span class="o">|</span> <span class="n">sum</span>
<span class="o">------------+------</span>
          <span class="mi">1</span> <span class="o">|</span> <span class="mi">2000</span>
          <span class="mi">2</span> <span class="o">|</span>  <span class="mi">900</span>
          <span class="mi">3</span> <span class="o">|</span>  <span class="mi">600</span>
<span class="o">(</span><span class="mi">3</span> <span class="n">rows</span><span class="o">)</span>
</code></pre></div></div> <p>Now we’re all set! We have a working SQL pipeline.</p> <p>In the next section, we’ll do a quick walk thru of how Napkin processes new ingested data.</p> <h3 id="processing-new-incoming-data"> <a href="#processing-new-incoming-data" class="anchor-heading" aria-labelledby="processing-new-incoming-data"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Processing new incoming data </h3> <p>As we ingest incoming data into the source tables, we will continuously execute the Napkin <code class="language-plaintext highlighter-rouge">run</code> command to recreate the target tables. Let’s quickly demonstrate this capability by:</p> <ul> <li>insert some new data in our source table, data ingestion:</li> </ul> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'INSERT INTO sale VALUES (5, 999,  3);'</span> | psql
</code></pre></div></div> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
</code></pre></div></div> <ul> <li>execute the Napkin pipeline:</li> </ul> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">17</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-revenue"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">18</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-seller"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-revenue"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-seller"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3644391</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span> <span class="mi">6</span> <span class="n">rows</span> <span class="n">affected</span>
</code></pre></div></div> <ul> <li> <p>verify pipeline execution:</p> <ul> <li>by <code class="language-plaintext highlighter-rouge">napkin history</code> command:</li> </ul> </li> </ul> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin <span class="nb">history </span>show <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Table</span> <span class="n">best</span><span class="o">-</span><span class="n">seller</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span> <span class="n">and</span> <span class="n">finished</span> <span class="n">at</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span> <span class="n">successfully</span> <span class="n">affecting</span> <span class="mi">3</span> <span class="n">rows</span>
<span class="nc">Table</span> <span class="n">best</span><span class="o">-</span><span class="n">revenue</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span> <span class="n">and</span> <span class="n">finished</span> <span class="n">at</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">03</span> <span class="mi">23</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">30</span> <span class="n">successfully</span> <span class="n">affecting</span> <span class="mi">3</span> <span class="n">rows</span>
</code></pre></div></div> <ul> <li>by <code class="language-plaintext highlighter-rouge">psql</code> command:</li> </ul> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'SELECT * FROM "best-seller";'</span> | psql
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">product_id</span> <span class="o">|</span> <span class="n">sum</span>
<span class="o">------------+------</span>
          <span class="mi">3</span> <span class="o">|</span> <span class="mi">1011</span>
          <span class="mi">1</span> <span class="o">|</span> <span class="mi">1000</span>
          <span class="mi">2</span> <span class="o">|</span>  <span class="mi">300</span>
<span class="o">(</span><span class="mi">3</span> <span class="n">rows</span><span class="o">)</span>
</code></pre></div></div> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'SELECT * FROM "best-revenue";'</span> | psql
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">product_id</span> <span class="o">|</span>  <span class="n">sum</span>
<span class="o">------------+-------</span>
          <span class="mi">3</span> <span class="o">|</span> <span class="mi">50550</span>
          <span class="mi">1</span> <span class="o">|</span>  <span class="mi">2000</span>
          <span class="mi">2</span> <span class="o">|</span>   <span class="mi">900</span>
<span class="o">(</span><span class="mi">3</span> <span class="n">rows</span><span class="o">)</span>
</code></pre></div></div> <p>As expected, the updated target tables reflect the change in source data and the <code class="language-plaintext highlighter-rouge">best-seller</code> table is updated with the new row with the value ‘kale’ in it on top.</p> <p>Thus far, we’ve managed to create and execute a Napkin SQL data pipeline. We also showed how our pipeline may continuously execute to accommodate newly ingested data. In the next we touch on Napkin templates and template variable interpolation capabilities.</p> <h2 id="using-templates-and-variable-interpolation"> <a href="#using-templates-and-variable-interpolation" class="anchor-heading" aria-labelledby="using-templates-and-variable-interpolation"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using Templates and Variable Interpolation </h2> <p>The next step in extending Napkin Spec is to utilize templates to parameterize our queries. This is an extremely important feature because it can be used for everything from handling different table or variable names in development vs production datasets or simply reusing the same query for multiple purposes.</p> <p>Template variables may be set in a Spec file or may be overridden globally with command line options. Template variables hold text to be used in substitution for the variable name in a template query. The final query should always be a valid SQL expression.</p> <p>Let’s work through an example. There are 2 versions of <a href="https://www.postgresql.org/docs/current/functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" target="_blank" rel="noopener noreferrer">STDDEV</a> functions in Postgres. Let’s compare them by computing the results in dedicated tables, but reusing a single parameterized query. to this:</p> <ul> <li>create the new query for the resulting table</li> <li>create the new parameterized STDDEV query</li> <li>update Napkin Spec, <code class="language-plaintext highlighter-rouge">spec/spec.yaml</code>, for the new queries</li> <li>validate Napkin Spec</li> <li>napkin <code class="language-plaintext highlighter-rouge">--dry-run</code>, this will give us the Napkin recipe for satisfying the pipeline execution</li> <li>execute Napkin Spec</li> </ul> <p><strong>First</strong> we create the required queries in <code class="language-plaintext highlighter-rouge">./sql/</code> folder as such:</p> <h4 id="sql-stddev-sql" class="top-code-caption"> <a href="#sql-stddev-sql" class="anchor-heading" aria-labelledby="sql-stddev-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/stddev.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="err">{{</span><span class="n">stddev</span><span class="err">}}</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="err">{{</span><span class="k">column_name</span><span class="err">}}</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="err">{{</span><span class="k">table_name</span><span class="err">}}</span> <span class="n">s</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">product</span> <span class="n">p</span> <span class="k">ON</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="p">)</span>
 <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div></div> <h4 id="sql-compare-sale-stddev-quantity-sql" class="top-code-caption"> <a href="#sql-compare-sale-stddev-quantity-sql" class="anchor-heading" aria-labelledby="sql-compare-sale-stddev-quantity-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/compare-sale-stddev-quantity.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">stddev_pop</span><span class="p">,</span> <span class="n">stddev_samp</span>
  <span class="k">FROM</span> <span class="n">sale_stddev_pop_quantity</span> <span class="n">p</span><span class="p">,</span> <span class="n">sale_stddev_sam_quantity</span> <span class="n">s</span>
 <span class="k">WHERE</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Second</strong> we modify the Napkin Spec, <code class="language-plaintext highlighter-rouge">specs/spec.yaml</code></p> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yaml-language-server: $schema=https://soostone-napkin-public.s3.us-east-1.amazonaws.com/schema/schema.json</span>

<span class="c1"># Connect to database:</span>
<span class="na">backend</span><span class="pi">:</span> <span class="s">Postgres</span>
<span class="na">db_url</span><span class="pi">:</span> <span class="s">postgresql://myUserName:myPassword@localhost/salesdb</span>
<span class="c1"># set your password by providing it using --uri or set PGPASSWORD variable</span>

<span class="c1"># backend: BigQuery</span>
<span class="c1"># db_url: bigquery://google/project_name?dataset=default_dataset_name</span>
<span class="c1"># Run `napkin auth` to obtain authentication token</span>

<span class="na">sql_folder</span><span class="pi">:</span> <span class="s">../sql</span>

<span class="na">tables</span><span class="pi">:</span>
  <span class="na">best-seller</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">best-seller.sql</span>

  <span class="na">best-revenue</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">best-revenue.sql</span>

  <span class="na">sale_stddev_sam_quantity</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">stddev.sql</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">vars</span><span class="pi">:</span>
        <span class="na">column_name</span><span class="pi">:</span> <span class="s">quantity</span>
        <span class="na">table_name</span><span class="pi">:</span> <span class="s">sale</span>
        <span class="s">stddev"</span><span class="err">:</span> <span class="s">stddev_pop</span>
      <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span>

  <span class="na">compare_sale_stddev_quantity</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">compare-sale-stddev-quantity.sql</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span>

  <span class="na">sale_stddev_pop_quantity</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">stddev.sql</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">vars</span><span class="pi">:</span>
        <span class="s">column_nam"</span><span class="err">:</span> <span class="s">quantity,</span>
        <span class="s">table_name</span><span class="err">:</span> <span class="s">sale,</span>
        <span class="s">stddev</span><span class="err">:</span> <span class="s">stddev_samp,</span>
      <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span>
</code></pre></div></div> <p><strong>Third</strong> we validate the Napkin Spec:</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin validate <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OK
</code></pre></div></div> <p><strong>Next</strong> we Napkin <code class="language-plaintext highlighter-rouge">run --dry-run</code> sub-command. Note that this is an informative command and doesn’t change the database state.</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml <span class="nt">--dry-run</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_pop_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_sam_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">][</span><span class="nl">table:</span><span class="s">"compare_sale_stddev_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-revenue"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">:</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-seller"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">:</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"compare_sale_stddev_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">:</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"sale_stddev_pop_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">:</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"sale_stddev_sam_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">:</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">01</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">49</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3718175</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span>
</code></pre></div></div> <p><strong>And finally</strong>, we execute the Napkin Spec</p> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin run <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_sam_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_pop_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-seller"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">][</span><span class="nl">table:</span><span class="s">"best-revenue"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.03</span><span class="o">.</span>
<span class="nl">NOTICE:</span>  <span class="n">table</span> <span class="s">"sale_stddev_pop_quantity"</span> <span class="n">does</span> <span class="n">not</span> <span class="n">exist</span><span class="o">,</span> <span class="n">skipping</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="nl">NOTICE:</span>  <span class="n">table</span> <span class="s">"sale_stddev_sam_quantity"</span> <span class="n">does</span> <span class="n">not</span> <span class="n">exist</span><span class="o">,</span> <span class="n">skipping</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">24</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-seller"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_pop_quantity"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">23</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"best-revenue"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">][</span><span class="nl">table:</span><span class="s">"sale_stddev_sam_quantity"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">26</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"sale_stddev_pop_quantity"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">27</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"sale_stddev_sam_quantity"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">][</span><span class="nl">table:</span><span class="s">"compare_sale_stddev_quantity"</span><span class="o">]</span> <span class="nc">Executing</span> <span class="n">table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">.</span>
<span class="nl">NOTICE:</span>  <span class="n">table</span> <span class="s">"compare_sale_stddev_quantity"</span> <span class="n">does</span> <span class="n">not</span> <span class="n">exist</span><span class="o">,</span> <span class="n">skipping</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">]</span> <span class="nc">Command</span> <span class="n">performed</span> <span class="n">in</span> <span class="mf">0.00</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">][</span><span class="nl">table:</span><span class="s">"compare_sale_stddev_quantity"</span><span class="o">]</span> <span class="nc">Table</span><span class="err">'</span><span class="n">s</span> <span class="n">action</span> <span class="n">complete</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">25</span><span class="o">]</span> <span class="nc">TableSpec</span> <span class="s">"compare_sale_stddev_quantity"</span> <span class="n">server</span> <span class="nl">stats:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Execution</span> <span class="n">completed</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">a</span> <span class="n">summary</span><span class="o">.</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="o">----------------------------------------------------------</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-revenue"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.03</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"best-seller"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.02</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"compare_sale_stddev_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.01</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"sale_stddev_pop_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.03</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Table</span> <span class="s">"sale_stddev_sam_quantity"</span> <span class="n">ran</span> <span class="n">in</span> <span class="mf">0.06</span><span class="o">:</span> <span class="mi">3</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="o">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">04</span> <span class="mo">02</span><span class="o">:</span><span class="mo">06</span><span class="o">:</span><span class="mi">16</span><span class="o">][</span><span class="n">combo</span><span class="o">][</span><span class="nc">Info</span><span class="o">][</span><span class="n">soostone</span><span class="o">-</span><span class="no">XPS</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">7590</span><span class="o">][</span><span class="no">PID</span> <span class="mi">3724249</span><span class="o">][</span><span class="nc">ThreadId</span> <span class="mi">4</span><span class="o">]</span> <span class="nc">Run</span> <span class="n">complete</span><span class="o">.</span> <span class="nc">Total</span> <span class="nl">cost:</span> <span class="mi">15</span> <span class="n">rows</span> <span class="n">affected</span>
</code></pre></div></div> <p><strong>Verifying the results</strong>:</p> <p>Note the newly created tables:</p> <ul> <li><code class="language-plaintext highlighter-rouge">sale_stddev_pop_quantity</code></li> <li><code class="language-plaintext highlighter-rouge">sale_stddev_sam_quantity</code></li> <li><code class="language-plaintext highlighter-rouge">compare_sale_stddev_quantity</code></li> </ul> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">salesdb</span><span class="o">=#</span> <span class="err">\</span><span class="n">d</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">best</span><span class="o">-</span><span class="n">revenue</span>                 <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">best</span><span class="o">-</span><span class="n">seller</span>                  <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">compare_sale_stddev_quantity</span> <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">example</span>                      <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">product</span>                      <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">sale</span>                         <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">sale_stddev_pop_quantity</span>     <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
 <span class="k">public</span> <span class="o">|</span> <span class="n">sale_stddev_sam_quantity</span>     <span class="o">|</span> <span class="k">table</span> <span class="o">|</span> <span class="n">soostone</span>
</code></pre></div></div> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'select * from "compare_sale_stddev_quantity"'</span> | psql
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">name</span>      <span class="o">|</span>    <span class="n">stddev_pop</span>    <span class="o">|</span>   <span class="n">stddev_samp</span>
<span class="o">---------------+------------------+------------------</span>
 <span class="n">coke</span>          <span class="o">|</span>                <span class="mi">0</span> <span class="o">|</span>
 <span class="n">kale</span>          <span class="o">|</span> <span class="mf">468.116082469580</span> <span class="o">|</span> <span class="mf">573.322771220540</span>
 <span class="n">chocolate</span> <span class="n">bar</span> <span class="o">|</span>                <span class="mi">0</span> <span class="o">|</span>
<span class="o">(</span><span class="mi">3</span> <span class="n">rows</span><span class="o">)</span>
</code></pre></div></div> <h2 id="misc"> <a href="#misc" class="anchor-heading" aria-labelledby="misc"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Misc </h2> <h3 id="unused-column-detection"> <a href="#unused-column-detection" class="anchor-heading" aria-labelledby="unused-column-detection"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unused column detection </h3> <p>Some table columns are introduced for debugging and development purposes. As time goes an engineer may stop using them and loose track of their existence. Meanwhile such columns continue to recruit cost and complexity. Napkin optimize command can address such use-cases.</p> <p>Here is an example:</p> <ul> <li>create the CTE SQL file: <code class="language-plaintext highlighter-rouge">./sql/cte-query.sql</code>
</li> </ul> <h4 id="sql-cte-query-sql" class="top-code-caption"> <a href="#sql-cte-query-sql" class="anchor-heading" aria-labelledby="sql-cte-query-sql"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sql/cte-query.sql </h4> <div class="language-sql copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">CTE</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="n">price</span> <span class="k">from</span> <span class="n">product</span><span class="p">)</span> <span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">CTE</span><span class="p">;</span>
</code></pre></div></div> <ul> <li>append the following YAML snippet to the end of the <code class="language-plaintext highlighter-rouge">spec/specs.yaml</code>
</li> </ul> <h4 id="spec-yaml" class="top-code-caption"> <a href="#spec-yaml" class="anchor-heading" aria-labelledby="spec-yaml"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> spec.yaml </h4> <div class="language-yaml copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">cte-query-table</span><span class="pi">:</span>
    <span class="na">create_action</span><span class="pi">:</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">cte-query.sql</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">sql_file</span>
      <span class="na">target_type</span><span class="pi">:</span> <span class="s">table</span>
</code></pre></div></div> <ul> <li>execute the <code class="language-plaintext highlighter-rouge">napkin optimize</code> command</li> </ul> <h4 id="shell" class="top-code-caption"> <a href="#shell" class="anchor-heading" aria-labelledby="shell"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> shell </h4> <div class="language-sh copiable highlighter-rouge"><div class="highlight"><pre class="highlight"><code>napkin optimize <span class="nt">--spec-file</span> ./specs/spec.yaml
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">unused</span> <span class="n">column</span> <span class="no">CTE</span><span class="o">.</span><span class="na">g</span>
</code></pre></div></div> <h2 id="more-resources"> <a href="#more-resources" class="anchor-heading" aria-labelledby="more-resources"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> More resources </h2> <p>The following resources are available for learning more about Napkin:</p> <ul> <li><code class="language-plaintext highlighter-rouge">napkin --help</code></li> <li>
<code class="language-plaintext highlighter-rouge">napkin version</code> much more info about internal operations (useful for bug reports)</li> <li><a href="/">napkin user’s guide</a></li> <li>Slack napkin <a href="https://napkincommunity.slack.com" target="_blank" rel="noopener noreferrer">channels</a>
</li> </ul> <h2 id="conclusion"> <a href="#conclusion" class="anchor-heading" aria-labelledby="conclusion"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusion </h2> <p>The purpose of this tutorial was to get you started with Napkin quickly. Consequently, we opted out on more advanced features of Napkin to keep the tutorial simple. We strongly recommend using Napkin <a href="https://en.wikipedia.org/wiki/Command-line_interface" target="_blank" rel="noopener noreferrer">CLI</a> help facility, <code class="language-plaintext highlighter-rouge">napkin --help</code> to get an intuition for some of the more advanced features of Napkin.</p> </div> </div> <div class="main-content-rspander"></div> <div class="search-overlay"></div> </div> <footer class="site-footer"> <div class="site-footer-rows"> <div class="site-footer-r1"> <div class="white-napkin"></div> <div class="sf-box"> <div class="sfb-nav"> <div class="link-table"> <a href="#" class="">Documentation</a> <a href="#" class="">Community</a> <a href="#" class="">Features</a> </div> <div class="link-table"> <a href="#" class="">Use Cases</a> <a href="#" class="">About Napkin</a> <a href="#" class="">Contact</a> </div> </div> <div class="gradient-border"> <a href="#" class="link-button">Get Napkin</a> </div> </div> </div> <div class="media-bar"> <span class="media-pad"> <a href="#" class="logo fb-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo twitter-logo"></a> </span> <span class="media-pad"> <a href="#" class="logo linked-in-logo"></a> </span> </div> <div class="site-footer-copy-right"> <div class="copyright"> Copyright 2021 ©    |    <a href="#">Privacy Policy</a> </div> <div class="made-with"> Made with <span class="heart-inline"> </span> in NYC </div> </div> </div> </footer> <div class="sortcat-shadow"> </div> <script type="text/javascript" src="/assets/js/copy.js"></script> <script type="text/javascript" src="/assets/js/highlight-active-link.js"></script> </body> </html>
